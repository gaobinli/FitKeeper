import{_ as re,N as ue}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BvwCvuJW.js";import{d as A,at as V,m as G,au as J,n as Q,q as X,a as Y,r as _,av as ie,c as Z,o as L,w as t,f as e,aK as ce,z as ee,az as te,aA as le,v as ne,ax as ae,x as oe,B as $,g as j,t as F,h as r,$ as k,aL as pe,L as se,E as de,ar as me,b as _e,aC as z,O as fe,aD as ve}from"./index-BAq2SbaD.js";import{f as W}from"./user-CToCrV-S.js";import{f as ge,a as he,b as H,c as be}from"./post-C8zjaOhA.js";import{u as ye,a as xe}from"./table-DmjEK7tG.js";import{W as we}from"./WangEditor-BCwDbreK.js";import{_ as ke,a as Ne,b as qe,c as Se}from"./round-refresh-DNCv4Ss6.js";import{_ as De}from"./DataTable-D6rjIJFQ.js";import"./wangEditor-CAqzKAJM.js";import"./RadioGroup-BGb2VClf.js";import"./Pagination-PYMt0YJG.js";const Ie=A({name:"PostOperateModal",__name:"post-operate-modal",props:V({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(h,{emit:R}){G();const c=h,T=R,b=J(h,"visible"),{formRef:S,validate:i,restoreValidation:P}=Q(),{defaultRequiredRule:y}=X(),U=Y(()=>({add:"新增",edit:"编辑"})[c.operateType]),n=_(N());function N(){return{id:null,title:null,content:null,userId:null,excellent:null}}const C={id:y,title:y,content:y,userId:y,excellent:y};function f(){n.value=N(),c.operateType==="edit"&&c.rowData&&Object.assign(n.value,c.rowData),n.value.url&&(p.value=[{id:"1",name:"我是react.png",status:"finished",url:n.value.url}],n.value.url)}function x(){b.value=!1}async function u(){var d;if(await i(),n.value.id){const{error:s,data:v}=await ge(n.value.id,n.value);if(s)return}else{const{error:s,data:v}=await he(n.value);if(s)return}(d=window.$message)==null||d.success(k("common.updateSuccess")),x(),T("submitted")}ie(b,()=>{b.value&&(f(),P(),B())});const p=_([]),w=d=>{n.value.content=d},q=_([]);async function B(){const{error:d,data:s}=await W();if(s){q.value=[];for(const v of s)q.value.push({label:v.name,value:v.id})}}const D=_([{label:"是",value:1},{label:"否",value:2}]);return(d,s)=>{const v=ne,g=le,O=ae,l=te,a=ee,o=ce,M=$,E=oe,m=pe;return L(),Z(m,{show:b.value,"onUpdate:show":s[3]||(s[3]=I=>b.value=I),title:U.value,preset:"card",class:"w-800px"},{footer:t(()=>[e(E,{justify:"end",size:16},{default:t(()=>[e(M,{onClick:x},{default:t(()=>[j(F(r(k)("common.cancel")),1)]),_:1}),e(M,{type:"primary",onClick:u},{default:t(()=>[j(F(r(k)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(o,{class:"h-480px pr-20px"},{default:t(()=>[e(a,{ref_key:"formRef",ref:S,model:n.value,rules:C,"label-placement":"left","label-width":100},{default:t(()=>[e(l,{responsive:"screen","item-responsive":""},{default:t(()=>[e(g,{span:"24 m:24",label:"标题：",path:"title"},{default:t(()=>[e(v,{value:n.value.title,"onUpdate:value":s[0]||(s[0]=I=>n.value.title=I),placeholder:"请输入标题"},null,8,["value"])]),_:1}),e(g,{span:"24 m:24",label:"用户：",path:"userId",class:"pr-24px"},{default:t(()=>[e(O,{value:n.value.userId,"onUpdate:value":s[1]||(s[1]=I=>n.value.userId=I),options:q.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(g,{span:"24 m:24",label:"是否热门：",path:"excellent"},{default:t(()=>[e(O,{value:n.value.excellent,"onUpdate:value":s[2]||(s[2]=I=>n.value.excellent=I),options:D.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(g,{span:"24 m:24",label:"内容：",path:"content"},{default:t(()=>[e(we,{contentHtml:n.value.content,onGetWangEditorValue:w},null,8,["contentHtml"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Te=A({name:"PostSearch",__name:"post-search",props:{model:{required:!0},modelModifiers:{}},emits:V(["reset","search"],["update:model"]),setup(h,{emit:R}){G();const c=R,{formRef:T,validate:b,restoreValidation:S}=Q(),i=J(h,"model"),P=Y(()=>{const{patternRules:x}=X();return{userEmail:x.email,userPhone:x.phone}});async function y(){await S(),c("reset")}async function U(){await b(),c("search")}const n=_([]);async function N(){const{error:x,data:u}=await W();if(u){n.value=[];for(const p of u)n.value.push({label:p.name,value:p.id})}}function C(){N()}const f=_([{label:"是",value:1},{label:"否",value:2}]);return C(),(x,u)=>{const p=ne,w=le,q=ae,B=qe,D=$,d=Se,s=oe,v=te,g=ee,O=Ne,l=ke,a=se;return L(),Z(a,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(l,{"default-expanded-names":["post-search"]},{default:t(()=>[e(O,{title:"搜索",name:"post-search"},{default:t(()=>[e(g,{ref_key:"formRef",ref:T,model:i.value,rules:P.value,"label-placement":"left","label-width":80},{default:t(()=>[e(v,{responsive:"screen","item-responsive":""},{default:t(()=>[e(w,{span:"24 s:12 m:6",label:"标题：",path:"qp_title_like",class:"pr-24px"},{default:t(()=>[e(p,{value:i.value.qp_title_like,"onUpdate:value":u[0]||(u[0]=o=>i.value.qp_title_like=o),placeholder:"请输入"},null,8,["value"])]),_:1}),e(w,{span:"24 s:12 m:6",label:"内容：",path:"qp_content_like",class:"pr-24px"},{default:t(()=>[e(p,{value:i.value.qp_content_like,"onUpdate:value":u[1]||(u[1]=o=>i.value.qp_content_like=o),placeholder:"请输入"},null,8,["value"])]),_:1}),e(w,{span:"24 s:12 m:6",label:"用户：",path:"qp_userId_eq",class:"pr-24px"},{default:t(()=>[e(q,{value:i.value.qp_userId_eq,"onUpdate:value":u[2]||(u[2]=o=>i.value.qp_userId_eq=o),options:n.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(w,{span:"24 s:12 m:6",label:"热门：",path:"qp_excellent_eq",class:"pr-24px"},{default:t(()=>[e(q,{value:i.value.qp_excellent_eq,"onUpdate:value":u[3]||(u[3]=o=>i.value.qp_excellent_eq=o),options:f.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(w,{span:"24 m:6",class:"pr-24px"},{default:t(()=>[e(s,{class:"w-full",justify:"start"},{default:t(()=>[e(D,{onClick:y},{icon:t(()=>[e(B,{class:"text-icon"})]),default:t(()=>[j(" "+F(r(k)("common.reset")),1)]),_:1}),e(D,{type:"primary",ghost:"",onClick:U},{icon:t(()=>[e(d,{class:"text-icon"})]),default:t(()=>[j(" "+F(r(k)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1})}}}),Pe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function K(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!ve(h)}const Ve=A({name:"forum_post",__name:"index",setup(h){const R=de(),{bool:c,setTrue:T}=me();G(),_(null);const{columns:b,columnChecks:S,data:i,loading:P,pagination:y,getData:U,getDataByPage:n,searchParams:N,resetSearchParams:C}=ye({apiFn:be,apiParams:{currentPage:1,pageSize:10,qp_title_like:null,qp_content_like:null,qp_userId_eq:null,qp_excellent_eq:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:"序号",align:"center"},{key:"title",title:"标题",align:"center"},{key:"userId",title:"用户",align:"center",render:l=>{if(l.userId){let a=[];for(const o of g.value)o.value===l.userId&&a.push(o.label);return a.join("、")}return""}},{key:"excellent",title:"是否热门",align:"center",render:l=>l.excellent===null?null:e(fe,{type:l.excellent===1?"success":"warning"},{default:()=>[l.excellent===1?"热门":"非热门"]})},{key:"modifyUser",title:"修改人",align:"center",render:l=>l.modifyTime?l.modifyTime.replace("T"," "):""},{key:"modifyTime",title:"修改时间",width:154,align:"center",render:l=>l.modifyTime?l.modifyTime.replace("T"," "):""},{key:"operate",title:k("common.operate"),align:"center",width:230,render:l=>{let a;return e("div",{class:"flex-center justify-center gap-8px"},[e($,{type:"primary",ghost:!0,size:"small",onClick:()=>d(l)},K(a=k("common.edit"))?a:{default:()=>[a]}),e(ue,{onPositiveClick:()=>B(l.id)},{default:()=>k("common.confirmDelete"),trigger:()=>{let o;return e($,{type:"error",ghost:!0,size:"small"},K(o=k("common.delete"))?o:{default:()=>[o]})}})])}}]}),{checkedRowKeys:f,onBatchDeleted:x,onDeleted:u}=xe(i,U),p=_("add");function w(){p.value="add",T()}async function q(){const{error:l,data:a}=await H(f.value);console.log(f.value),x()}async function B(l){const{error:a,data:o}=await H(l);console.log(l),u()}const D=_(null);function d(l){p.value="edit",D.value={...l},T()}const s=_([]);function v(){O()}const g=_([]);async function O(){const{error:l,data:a}=await W();if(a){g.value=[];for(const o of a)g.value.push({label:o.name,value:o.id})}}return v(),(l,a)=>{const o=re,M=De,E=se;return L(),_e("div",Pe,[e(Te,{model:r(N),"onUpdate:model":a[0]||(a[0]=m=>z(N)?N.value=m:null),onReset:r(C),onSearch:r(n)},null,8,["model","onReset","onSearch"]),e(E,{title:"数据列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[e(o,{columns:r(S),"onUpdate:columns":a[1]||(a[1]=m=>z(S)?S.value=m:null),"disabled-delete":r(f).length===0,loading:r(P),onAdd:w,onDelete:q,onRefresh:r(U)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:t(()=>[e(M,{"checked-row-keys":r(f),"onUpdate:checkedRowKeys":a[2]||(a[2]=m=>z(f)?f.value=m:null),columns:r(b),data:r(i),size:"small","flex-height":!r(R).isMobile,"scroll-x":1088,loading:r(P),"row-key":m=>m.id,remote:"",pagination:r(y),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ie,{visible:r(c),"onUpdate:visible":a[3]||(a[3]=m=>z(c)?c.value=m:null),"operate-type":p.value,"row-data":D.value,"all-pages":s.value,onSubmitted:r(n)},null,8,["visible","operate-type","row-data","all-pages","onSubmitted"])]),_:1})])}}});export{Ve as default};
