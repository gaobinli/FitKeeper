import{_ as ze,N as Pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BvwCvuJW.js";import{d as se,at as ne,m as ue,au as ye,n as Se,q as we,a as ke,r as c,av as oe,c as Z,o as M,w as l,f as e,aK as Ie,z as ie,az as qe,aA as Ne,v as re,ax as ce,aN as je,x as de,B as O,g as U,t as B,h as i,$ as y,aL as xe,aO as Fe,aq as he,L as De,E as Ve,ar as Ae,p as Ee,b as le,aC as X,s as Le,aD as He}from"./index-BAq2SbaD.js";import{d as pe,_ as Ge}from"./coach-BsqHLKrd.js";import{d as me}from"./classification-BjF0CaOi.js";import{f as Ce,a as We,b as be,c as Ye}from"./course-Fx5oIOxk.js";import{u as Ke,a as Je}from"./table-DmjEK7tG.js";import{W as Qe}from"./WangEditor-BCwDbreK.js";import{_ as Ue}from"./Rate-pIVGMApm.js";import{_ as Xe}from"./Upload-DmXdhDTT.js";import{_ as Ze,a as et,b as tt,c as at}from"./round-refresh-DNCv4Ss6.js";import{_ as lt}from"./DataTable-D6rjIJFQ.js";import{_ as nt}from"./Image-Bgw24gBA.js";import"./Pagination-PYMt0YJG.js";import"./wangEditor-CAqzKAJM.js";import"./RadioGroup-BGb2VClf.js";const ot=se({name:"CourseOperateModal",__name:"course-operate-modal",props:ne({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ne(["submitted"],["update:visible"]),setup(N,{emit:S}){const z="http://localhost:9000/upload";ue();const b=N,P=S,w=ye(N,"visible"),{formRef:E,validate:f,restoreValidation:j}=Se(),{defaultRequiredRule:v}=we(),L=ke(()=>({add:"新增",edit:"编辑"})[b.operateType]),t=c(T());function T(){return{id:null,name:null,coachId:null,price:null,classificationId:null,coverUrl:null,content:null,courseTime:null,limitNumber:null,simpleDesc:null,auditDesc:null,auditStatus:null,recommendedScore:null}}const k={id:v,name:v,coachId:v,price:v,classificationId:v,coverUrl:v,content:v,courseTime:v,limitNumber:v,recommendedScore:v};function H(){t.value=T(),b.operateType==="edit"&&b.rowData?(Object.assign(t.value,b.rowData),t.value.courseTime&&typeof t.value.courseTime=="string"&&(t.value.courseTime=new Date(t.value.courseTime).getTime())):b.operateType==="add"&&(t.value.auditStatus=1),t.value.coverUrl&&(g.value=[{id:"1",name:"我是react.png",status:"finished",url:t.value.coverUrl}],t.value.coverUrl)}function I(){w.value=!1}async function G(){var n;await f();const s={...t.value};if(s.courseTime&&typeof s.courseTime=="number"&&(s.courseTime=Fe(s.courseTime).format("YYYY-MM-DD HH:mm:ss")),t.value.id){s.auditStatus=1;const{error:m,data:_}=await Ce(t.value.id,s);if(m)return}else{const{error:m,data:_}=await We(s);if(m)return}(n=window.$message)==null||n.success(y("common.updateSuccess")),I(),P("submitted")}oe(w,()=>{w.value?(H(),j(),x(),F()):g.value=[]});const g=c([]);function d(s){var n;s&&s.event&&((n=s.event)!=null&&n.target)&&s.event.target.response&&(t.value.coverUrl=JSON.parse(s.event.target.response).data),t.value.coverUrl&&(g.value=[{id:"1",name:"我是react.png",status:"finished",url:t.value.coverUrl}],t.value.coverUrl)}const h=c([]);async function x(){const{error:s,data:n}=await pe();if(n){h.value=[];for(const m of n)h.value.push({label:m.name,value:m.id})}}const D=c([]);async function F(){const{error:s,data:n}=await me();if(n){D.value=[];for(const m of n)D.value.push({label:m.name,value:m.id})}}const V=s=>{t.value.content=s};return c([{label:"待审核",value:1},{label:"审核驳回",value:2},{label:"审核通过",value:3}]),(s,n)=>{const m=re,_=Ne,R=Xe,C=ce,A=je,q=Ge,ee=Ue,$=qe,te=ie,W=Ie,K=O,Y=de,ae=xe;return M(),Z(ae,{show:w.value,"onUpdate:show":n[8]||(n[8]=p=>w.value=p),title:L.value,preset:"card",class:"w-800px"},{footer:l(()=>[e(Y,{justify:"end",size:16},{default:l(()=>[e(K,{onClick:I},{default:l(()=>[U(B(i(y)("common.cancel")),1)]),_:1}),e(K,{type:"primary",onClick:G},{default:l(()=>[U(B(i(y)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(W,{class:"h-480px pr-20px"},{default:l(()=>[e(te,{ref_key:"formRef",ref:E,model:t.value,rules:k,"label-placement":"left","label-width":100},{default:l(()=>[e($,{responsive:"screen","item-responsive":""},{default:l(()=>[e(_,{span:"24 m:24",label:"课程名称：",path:"name"},{default:l(()=>[e(m,{value:t.value.name,"onUpdate:value":n[0]||(n[0]=p=>t.value.name=p),placeholder:"请输入课程名称"},null,8,["value"])]),_:1}),e(_,{span:"24 m:24",label:"课程封面：",path:"url"},{default:l(()=>[e(R,{action:z,"default-file-list":g.value,"list-type":"image-card",max:1,onChange:d},null,8,["default-file-list"])]),_:1}),e(_,{span:"24 m:24",label:"教练：",path:"coachId",class:"pr-24px"},{default:l(()=>[e(C,{value:t.value.coachId,"onUpdate:value":n[1]||(n[1]=p=>t.value.coachId=p),options:h.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(_,{span:"24 m:24",label:"分类：",path:"classificationId",class:"pr-24px"},{default:l(()=>[e(C,{value:t.value.classificationId,"onUpdate:value":n[2]||(n[2]=p=>t.value.classificationId=p),options:D.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(_,{span:"24 m:24",label:"价格：",path:"price"},{default:l(()=>[e(A,{value:t.value.price,"onUpdate:value":n[3]||(n[3]=p=>t.value.price=p),placeholder:"请输入价格"},null,8,["value"])]),_:1}),e(_,{span:"24 m:24",label:"课程时间：",path:"courseTime"},{default:l(()=>[e(q,{value:t.value.courseTime,"onUpdate:value":n[4]||(n[4]=p=>t.value.courseTime=p),type:"datetime",clearable:""},null,8,["value"])]),_:1}),e(_,{span:"24 m:24",label:"限制人数：",path:"limitNumber"},{default:l(()=>[e(A,{value:t.value.limitNumber,"onUpdate:value":n[5]||(n[5]=p=>t.value.limitNumber=p),placeholder:"请输入限制人数"},null,8,["value"])]),_:1}),e(_,{span:"24 m:24",label:"简单描述：",path:"simpleDesc"},{default:l(()=>[e(m,{value:t.value.simpleDesc,"onUpdate:value":n[6]||(n[6]=p=>t.value.simpleDesc=p),type:"textarea",placeholder:"请输入简单描述"},null,8,["value"])]),_:1}),e(_,{span:"24 m:24",label:"推荐指数：",path:"recommendedScore"},{default:l(()=>[e(ee,{value:t.value.recommendedScore,"onUpdate:value":n[7]||(n[7]=p=>t.value.recommendedScore=p)},null,8,["value"])]),_:1}),e(_,{span:"24 m:24",label:"课程内容：",path:"content"},{default:l(()=>[e(Qe,{contentHtml:t.value.content,onGetWangEditorValue:V},null,8,["contentHtml"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),st=se({name:"CourseSearch",__name:"course-search",props:{model:{required:!0},modelModifiers:{}},emits:ne(["reset","search"],["update:model"]),setup(N,{emit:S}){const z=ue(),b=S,{formRef:P,validate:w,restoreValidation:E}=Se(),f=ye(N,"model"),j=ke(()=>{const{patternRules:g}=we();return{userEmail:g.email,userPhone:g.phone}});async function v(){await E(),b("reset")}async function L(){await w(),b("search")}const t=c([]);async function T(){const{error:g,data:d}=await pe();if(d){t.value=[];for(const h of d)t.value.push({label:h.name,value:h.id})}}const k=c([]);async function H(){const{error:g,data:d}=await me();if(d){k.value=[];for(const h of d)k.value.push({label:h.name,value:h.id})}}const I=c([{label:"待审核",value:1},{label:"审核驳回",value:2},{label:"审核通过",value:3}]);function G(){T(),H()}return G(),(g,d)=>{const h=re,x=Ne,D=ce,F=tt,V=O,s=at,n=de,m=qe,_=ie,R=et,C=Ze,A=De;return M(),Z(A,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[e(C,{"default-expanded-names":["course-search"]},{default:l(()=>[e(R,{title:"搜索",name:"course-search"},{default:l(()=>[e(_,{ref_key:"formRef",ref:P,model:f.value,rules:j.value,"label-placement":"left","label-width":80},{default:l(()=>[e(m,{responsive:"screen","item-responsive":""},{default:l(()=>[i(z).userInfo.role!=="other"?(M(),Z(x,{key:0,span:"24 s:12 m:6",label:"课程名称：",path:"qp_name_like",class:"pr-24px","label-width":100},{default:l(()=>[e(h,{value:f.value.qp_name_like,"onUpdate:value":d[0]||(d[0]=q=>f.value.qp_name_like=q),placeholder:"请输入"},null,8,["value"])]),_:1})):he("",!0),i(z).userInfo.role!=="other"?(M(),Z(x,{key:1,span:"24 s:12 m:6",label:"教练：",path:"qp_coachId_eq",class:"pr-24px","label-width":100},{default:l(()=>[e(D,{value:f.value.qp_coachId_eq,"onUpdate:value":d[1]||(d[1]=q=>f.value.qp_coachId_eq=q),options:t.value,placeholder:"请选择"},null,8,["value","options"])]),_:1})):he("",!0),e(x,{span:"24 s:12 m:6",label:"分类：",path:"qp_classificationId_eq",class:"pr-24px","label-width":100},{default:l(()=>[e(D,{value:f.value.qp_classificationId_eq,"onUpdate:value":d[2]||(d[2]=q=>f.value.qp_classificationId_eq=q),options:k.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(x,{span:"24 s:12 m:6",label:"审核状态：",path:"qp_auditStatus_eq",class:"pr-24px","label-width":100},{default:l(()=>[e(D,{value:f.value.qp_auditStatus_eq,"onUpdate:value":d[3]||(d[3]=q=>f.value.qp_auditStatus_eq=q),options:I.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(x,{span:"24 m:6",class:"pr-24px","label-width":100},{default:l(()=>[e(n,{class:"w-full",justify:"start"},{default:l(()=>[e(V,{onClick:v},{icon:l(()=>[e(F,{class:"text-icon"})]),default:l(()=>[U(" "+B(i(y)("common.reset")),1)]),_:1}),e(V,{type:"primary",ghost:"",onClick:L},{icon:l(()=>[e(s,{class:"text-icon"})]),default:l(()=>[U(" "+B(i(y)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1})}}}),ut={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},it=["innerHTML"],rt={key:1,class:"text-center text-gray-500 p-16px"};function ge(N){return typeof N=="function"||Object.prototype.toString.call(N)==="[object Object]"&&!He(N)}const qt=se({name:"course",__name:"index",setup(N){const S=ue(),z=Ve(),{bool:b,setTrue:P}=Ae();c(null);const w=Ee({currentPage:1,pageSize:10,qp_name_like:null,qp_coachId_eq:null,qp_price_like:null,qp_classificationId_eq:null,qp_coverUrl_like:null,qp_content_like:null,qp_courseTime_like:null,qp_limitNumber_like:null,qp_auditDesc_like:null,qp_auditStatus_eq:null,qp_recommendedScore_like:null,qp_simpleDesc_like:null}),{columns:E,columnChecks:f,data:j,loading:v,pagination:L,getData:t,getDataByPage:T,searchParams:k,resetSearchParams:H}=Ke({apiFn:Ye,apiParams:w,immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:"序号",align:"center"},{key:"name",title:"课程名称",align:"center"},{key:"coachId",title:"教练",align:"center",render:a=>{if(a.coachId){let o=[];for(const r of W.value)r.value===a.coachId&&o.push(r.label);return o.join("、")}return""}},{key:"price",title:"价格",align:"center"},{key:"classificationId",title:"分类",align:"center",render:a=>{if(a.classificationId){let o=[];for(const r of Y.value)r.value===a.classificationId&&o.push(r.label);return o.join("、")}return""}},{key:"coverUrl",title:"课程封面",align:"center",render:a=>a.coverUrl===null?null:e(nt,{src:a.coverUrl,width:"100"},null)},{key:"content",title:"课程内容",align:"center",render:a=>e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>A(a)},{default:()=>[U("查看")]})},{key:"courseTime",title:"课程时间",width:154,align:"center",render:a=>a.courseTime?a.courseTime.replace("T"," "):""},{key:"limitNumber",title:"限制人数",align:"center"},{key:"simpleDesc",title:"简单描述",align:"center"},{key:"auditDesc",title:"审核描述",align:"center"},{key:"auditStatus",title:"审核状态",align:"center",render:a=>{if(a.auditStatus){let o=[];for(const r of _e.value)r.value===a.auditStatus&&o.push(r.label);return o.join("、")}return""}},{key:"recommendedScore",title:"推荐指数",align:"center",render:a=>a.recommendedScore===null||a.recommendedScore===void 0?null:e(Ue,{value:a.recommendedScore,readonly:!0},null)},{key:"operate",title:y("common.operate"),align:"center",width:300,render:a=>{let o;return e("div",{class:"flex-center justify-center gap-8px"},[e(O,{type:"primary",ghost:!0,size:"small",onClick:()=>V(a)},ge(o=y("common.edit"))?o:{default:()=>[o]}),e(O,{type:"warning",ghost:!0,size:"small",onClick:()=>m(a)},{default:()=>[U("审核")]}),e(Pe,{onPositiveClick:()=>D(a.id)},{default:()=>y("common.confirmDelete"),trigger:()=>{let r;return e(O,{type:"error",ghost:!0,size:"small"},ge(r=y("common.delete"))?r:{default:()=>[r]})}})])}}]}),{checkedRowKeys:I,onBatchDeleted:G,onDeleted:g}=Je(j,t),d=c("add");function h(){d.value="add",P()}async function x(){const{error:a,data:o}=await be(I.value);console.log(I.value),G()}async function D(a){const{error:o,data:r}=await be(a);console.log(a),g()}const F=c(null);function V(a){d.value="edit",F.value={...a},P()}const s=c(!1);c(null);const n=c({id:null,auditStatus:null,auditDesc:null});function m(a){n.value={id:a.id,auditStatus:a.auditStatus||null,auditDesc:a.auditDesc||null},s.value=!0}async function _(){var J,Q;if(!n.value.auditStatus||!n.value.auditDesc){(J=window.$message)==null||J.error("审核状态和审核描述都必须填写");return}const a={id:n.value.id,auditStatus:n.value.auditStatus,auditDesc:n.value.auditDesc},{error:o,data:r}=await Ce(n.value.id,a);o||((Q=window.$message)==null||Q.success(y("common.updateSuccess")),s.value=!1,T())}const R=c(!1),C=c(null);function A(a){C.value={name:a.name,content:a.content},R.value=!0}const q=c([]),ee=c(!1);function $(){S.userInfo.role==="other"&&S.userInfo.userId?(w.qp_coachId_eq=S.userInfo.userId,k.qp_coachId_eq=S.userInfo.userId):(w.qp_coachId_eq=null,k.qp_coachId_eq=null)}function te(){K(),ae(),$(),t(),ee.value=!0}oe(()=>S.userInfo.role,a=>{a!==void 0&&($(),t())}),oe(()=>S.userInfo.userId,a=>{a&&S.userInfo.role==="other"&&($(),t())});const W=c([]);async function K(){const{error:a,data:o}=await pe();if(o){W.value=[];for(const r of o)W.value.push({label:r.name,value:r.id})}}const Y=c([]);async function ae(){const{error:a,data:o}=await me();if(o){Y.value=[];for(const r of o)Y.value.push({label:r.name,value:r.id})}}function p(){$(),T()}function Te(){H(),$()}const _e=c([{label:"待审核",value:1},{label:"审核驳回",value:2},{label:"审核通过",value:3}]);return te(),(a,o)=>{const r=ze,J=lt,Q=ce,fe=Le,Oe=re,Re=ie,$e=de,ve=xe,Me=Ie,Be=De;return M(),le("div",ut,[e(st,{model:i(k),"onUpdate:model":o[0]||(o[0]=u=>X(k)?k.value=u:null),onReset:Te,onSearch:p},null,8,["model"]),e(Be,{title:"数据列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[e(r,{columns:i(f),"onUpdate:columns":o[1]||(o[1]=u=>X(f)?f.value=u:null),"disabled-delete":i(I).length===0,loading:i(v),onAdd:h,onDelete:x,onRefresh:i(t)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:l(()=>[e(J,{"checked-row-keys":i(I),"onUpdate:checkedRowKeys":o[2]||(o[2]=u=>X(I)?I.value=u:null),columns:i(E),data:i(j),size:"small","flex-height":!i(z).isMobile,"scroll-x":1088,loading:i(v),"row-key":u=>u.id,remote:"",pagination:i(L),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(ot,{visible:i(b),"onUpdate:visible":o[3]||(o[3]=u=>X(b)?b.value=u:null),"operate-type":d.value,"row-data":F.value,"all-pages":q.value,onSubmitted:i(T)},null,8,["visible","operate-type","row-data","all-pages","onSubmitted"]),e(ve,{show:s.value,"onUpdate:show":o[7]||(o[7]=u=>s.value=u),title:"课程审核",preset:"card",class:"w-600px"},{footer:l(()=>[e($e,{justify:"end",size:16},{default:l(()=>[e(i(O),{onClick:o[6]||(o[6]=u=>s.value=!1)},{default:l(()=>[U(B(i(y)("common.cancel")),1)]),_:1}),e(i(O),{type:"primary",onClick:_},{default:l(()=>[U(B(i(y)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[e(Re,{"label-placement":"left","label-width":100},{default:l(()=>[e(fe,{label:"审核状态：",required:""},{default:l(()=>[e(Q,{value:n.value.auditStatus,"onUpdate:value":o[4]||(o[4]=u=>n.value.auditStatus=u),options:_e.value,placeholder:"请选择审核状态"},null,8,["value","options"])]),_:1}),e(fe,{label:"审核描述：",required:""},{default:l(()=>[e(Oe,{value:n.value.auditDesc,"onUpdate:value":o[5]||(o[5]=u=>n.value.auditDesc=u),type:"textarea",placeholder:"请输入审核描述",rows:4},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["show"]),e(ve,{show:R.value,"onUpdate:show":o[8]||(o[8]=u=>R.value=u),preset:"card",class:"w-900px"},{header:l(()=>{var u;return[U(B((u=C.value)==null?void 0:u.name)+" - 课程内容 ",1)]}),default:l(()=>[e(Me,{class:"h-480px"},{default:l(()=>{var u;return[(u=C.value)!=null&&u.content?(M(),le("div",{key:0,innerHTML:C.value.content,class:"prose prose-sm max-w-none p-16px"},null,8,it)):(M(),le("div",rt," 暂无课程内容 "))]}),_:1})]),_:1},8,["show"])]),_:1})])}}});export{qt as default};
