import{_ as De,N as Ce}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BvwCvuJW.js";import{d as te,at as Z,m as ae,au as de,n as pe,q as me,a as fe,r,av as H,c as ee,o as J,w as o,f as e,aK as Re,z as oe,az as _e,aA as ve,ax as ne,aN as Oe,x as le,B as M,g as U,t as P,h as u,$ as I,aL as he,aq as Ue,L as be,E as Be,ar as Te,p as $e,b as je,aC as K,s as Fe,v as Me,aD as Pe}from"./index-BAq2SbaD.js";import{f as se}from"./user-CToCrV-S.js";import{e as ze,d as ue,c as Ae}from"./course-Fx5oIOxk.js";import{a as ge,b as Ve,c as ce,d as Le}from"./courseReserve-DbkDLQYx.js";import{u as Ge,a as Ee}from"./table-DmjEK7tG.js";import{_ as Ke,a as He,b as Je,c as Qe}from"./round-refresh-DNCv4Ss6.js";import{_ as We}from"./DataTable-D6rjIJFQ.js";import"./RadioGroup-BGb2VClf.js";import"./Pagination-PYMt0YJG.js";const Xe=te({name:"CourseReserveOperateModal",__name:"courseReserve-operate-modal",props:Z({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Z(["submitted"],["update:visible"]),setup(N,{emit:z}){ae();const S=N,B=z,i=de(N,"visible"),{formRef:k,validate:T,restoreValidation:h}=pe(),{defaultRequiredRule:q}=me(),$=fe(()=>({add:"新增",edit:"编辑"})[S.operateType]),l=r(R());function R(){return{id:null,userId:null,courseId:null,price:null,auditDesc:null,auditStatus:1}}const x={id:q,userId:q,courseId:q,price:q};function D(){l.value=R(),S.operateType==="edit"&&S.rowData&&Object.assign(l.value,S.rowData),l.value.url&&(g.value=[{id:"1",name:"我是react.png",status:"finished",url:l.value.url}],l.value.url)}function b(){i.value=!1}async function A(){var _;if(await T(),l.value.id){const{error:n,data:c}=await ge(l.value.id,l.value);if(n)return}else{const{error:n,data:c}=await Ve(l.value);if(n)return}(_=window.$message)==null||_.success(I("common.updateSuccess")),b(),B("submitted")}H(()=>l.value.courseId,async _=>{if(_){const{error:n,data:c}=await ze(_);!n&&c&&(l.value.price=c.price)}}),H(i,()=>{i.value?(D(),h(),d(),O()):g.value=[]});const g=r([]),y=r([]);async function d(){const{error:_,data:n}=await se();if(n){y.value=[];for(const c of n)y.value.push({label:c.name,value:c.id})}}const p=r([]);async function O(){const{error:_,data:n}=await ue();if(n){p.value=[];for(const c of n)p.value.push({label:c.name,value:c.id})}}return r([{label:"待审核",value:1},{label:"审核驳回",value:2},{label:"审核通过",value:3}]),(_,n)=>{const c=ne,w=ve,f=Oe,V=_e,L=oe,G=Re,j=M,C=le,Q=he;return J(),ee(Q,{show:i.value,"onUpdate:show":n[3]||(n[3]=v=>i.value=v),title:$.value,preset:"card",class:"w-800px"},{footer:o(()=>[e(C,{justify:"end",size:16},{default:o(()=>[e(j,{onClick:b},{default:o(()=>[U(P(u(I)("common.cancel")),1)]),_:1}),e(j,{type:"primary",onClick:A},{default:o(()=>[U(P(u(I)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[e(G,{class:"h-480px pr-20px"},{default:o(()=>[e(L,{ref_key:"formRef",ref:k,model:l.value,rules:x,"label-placement":"left","label-width":100},{default:o(()=>[e(V,{responsive:"screen","item-responsive":""},{default:o(()=>[e(w,{span:"24 m:24",label:"用户：",path:"userId",class:"pr-24px"},{default:o(()=>[e(c,{value:l.value.userId,"onUpdate:value":n[0]||(n[0]=v=>l.value.userId=v),options:y.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(w,{span:"24 m:24",label:"课程：",path:"courseId",class:"pr-24px"},{default:o(()=>[e(c,{value:l.value.courseId,"onUpdate:value":n[1]||(n[1]=v=>l.value.courseId=v),options:p.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(w,{span:"24 m:24",label:"价格：",path:"price"},{default:o(()=>[e(f,{value:l.value.price,"onUpdate:value":n[2]||(n[2]=v=>l.value.price=v),placeholder:"请输入价格",disabled:!0},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ye=te({name:"CourseReserveSearch",__name:"courseReserve-search",props:{model:{required:!0},modelModifiers:{}},emits:Z(["reset","search"],["update:model"]),setup(N,{emit:z}){const S=ae(),B=z,{formRef:i,validate:k,restoreValidation:T}=pe(),h=de(N,"model"),q=fe(()=>{const{patternRules:y}=me();return{userEmail:y.email,userPhone:y.phone}});async function $(){await T(),B("reset")}async function l(){await k(),B("search")}const R=r([]);async function x(){const{error:y,data:d}=await se();if(d){R.value=[];for(const p of d)R.value.push({label:p.name,value:p.id})}}const D=r([]);async function b(){const{error:y,data:d}=await ue();if(d){D.value=[];for(const p of d)D.value.push({label:p.name,value:p.id})}}const A=r([{label:"待审核",value:1},{label:"审核驳回",value:2},{label:"审核通过",value:3}]);function g(){x(),b()}return g(),(y,d)=>{const p=ne,O=ve,_=Je,n=M,c=Qe,w=le,f=_e,V=oe,L=He,G=Ke,j=be;return J(),ee(j,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[e(G,{"default-expanded-names":["courseReserve-search"]},{default:o(()=>[e(L,{title:"搜索",name:"courseReserve-search"},{default:o(()=>[e(V,{ref_key:"formRef",ref:i,model:h.value,rules:q.value,"label-placement":"left","label-width":80},{default:o(()=>[e(f,{responsive:"screen","item-responsive":""},{default:o(()=>[e(O,{span:"24 s:12 m:6",label:"用户：",path:"qp_userId_eq",class:"pr-24px","label-width":100},{default:o(()=>[e(p,{value:h.value.qp_userId_eq,"onUpdate:value":d[0]||(d[0]=C=>h.value.qp_userId_eq=C),options:R.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),u(S).userInfo.role!=="other"?(J(),ee(O,{key:0,span:"24 s:12 m:6",label:"课程：",path:"qp_courseId_eq",class:"pr-24px","label-width":100},{default:o(()=>[e(p,{value:h.value.qp_courseId_eq,"onUpdate:value":d[1]||(d[1]=C=>h.value.qp_courseId_eq=C),options:D.value,placeholder:"请选择"},null,8,["value","options"])]),_:1})):Ue("",!0),e(O,{span:"24 s:12 m:6",label:"预约状态：",path:"qp_auditStatus_eq",class:"pr-24px","label-width":100},{default:o(()=>[e(p,{value:h.value.qp_auditStatus_eq,"onUpdate:value":d[2]||(d[2]=C=>h.value.qp_auditStatus_eq=C),options:A.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(O,{span:"24 m:6",class:"pr-24px","label-width":100},{default:o(()=>[e(w,{class:"w-full",justify:"start"},{default:o(()=>[e(n,{onClick:$},{icon:o(()=>[e(_,{class:"text-icon"})]),default:o(()=>[U(" "+P(u(I)("common.reset")),1)]),_:1}),e(n,{type:"primary",ghost:"",onClick:l},{icon:o(()=>[e(c,{class:"text-icon"})]),default:o(()=>[U(" "+P(u(I)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1})}}}),Ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function et(N){return typeof N=="function"||Object.prototype.toString.call(N)==="[object Object]"&&!Pe(N)}const dt=te({name:"coursereserve",__name:"index",setup(N){const z=Be(),{bool:S,setTrue:B}=Te(),i=ae();r(null);const k=r("");r(!1);const T=$e({currentPage:1,pageSize:10,qp_userId_eq:null,qp_courseId_eq:null,qp_price_like:null,qp_auditDesc_like:null,qp_auditStatus_eq:null,qp_courseId_in:null}),{columns:h,columnChecks:q,data:$,loading:l,pagination:R,getData:x,getDataByPage:D,searchParams:b,resetSearchParams:A}=Ge({apiFn:Le,apiParams:T,immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:"序号",align:"center"},{key:"userId",title:"用户",align:"center",render:a=>{if(a.userId){let t=[];for(const s of X.value)s.value===a.userId&&t.push(s.label);return t.join("、")}return""}},{key:"courseId",title:"课程",align:"center",render:a=>{if(a.courseId){let t=[];for(const s of Y.value)s.value===a.courseId&&t.push(s.label);return t.join("、")}return""}},{key:"price",title:"价格",align:"center"},{key:"auditStatus",title:"预约状态",align:"center",render:a=>{if(a.auditStatus){let t=[];for(const s of re.value)s.value===a.auditStatus&&t.push(s.label);return t.join("、")}return""}},{key:"auditDesc",title:"审核描述",align:"center"},{key:"modifyUser",title:"修改人",align:"center"},{key:"modifyTime",title:"修改时间",width:154,align:"center",render:a=>a.modifyTime?a.modifyTime.replace("T"," "):""},{key:"operate",title:I("common.operate"),align:"center",width:300,render:a=>e("div",{class:"flex-center justify-center gap-8px"},[e(M,{type:"warning",ghost:!0,size:"small",onClick:()=>V(a)},{default:()=>[U("审核")]}),e(Ce,{onPositiveClick:()=>n(a.id)},{default:()=>I("common.confirmDelete"),trigger:()=>{let t;return e(M,{type:"error",ghost:!0,size:"small"},et(t=I("common.delete"))?t:{default:()=>[t]})}})])}]}),{checkedRowKeys:g,onBatchDeleted:y,onDeleted:d}=Ee($,x),p=r("add");function O(){p.value="add",B()}async function _(){const{error:a,data:t}=await ce(g.value);console.log(g.value),y()}async function n(a){const{error:t,data:s}=await ce(a);console.log(a),d()}const c=r(null),w=r(!1);r(null);const f=r({id:null,auditStatus:null,auditDesc:null});function V(a){f.value={id:a.id,auditStatus:a.auditStatus||null,auditDesc:a.auditDesc||null},w.value=!0}async function L(){var F,E;if(!f.value.auditStatus||!f.value.auditDesc){(F=window.$message)==null||F.error("预约状态和审核描述都必须填写");return}const a={id:f.value.id,auditStatus:f.value.auditStatus,auditDesc:f.value.auditDesc},{error:t,data:s}=await ge(f.value.id,a);t||((E=window.$message)==null||E.success(I("common.updateSuccess")),w.value=!1,D())}const G=r([]),j=r(!1);async function C(){ye(),we(),i.userInfo.role==="other"&&i.userInfo.userId&&await W(),v(),x(),j.value=!0}function Q(){v(),D()}function v(){i.userInfo.role==="other"&&k.value?b.qp_courseId_in=k.value:i.userInfo.role==="admin"&&(b.qp_courseId_in=null)}async function W(){try{const{error:a,data:t}=await Ae({qp_coachId_eq:i.userInfo.userId});if(!a&&t&&t.list&&t.list.length>0){const s=t.list.map(F=>F.id).join(",");return k.value=s,T.qp_courseId_in=s,b.qp_courseId_in=s,!0}return!1}catch(a){return console.error("Failed to fetch coach courses:",a),!1}}H(()=>i.userInfo.role,async a=>{a!==void 0&&(a==="other"&&i.userInfo.userId&&!k.value&&await W(),v(),x())}),H(()=>i.userInfo.userId,async a=>{a&&i.userInfo.role==="other"&&!k.value&&(await W(),v(),x())});const X=r([]);async function ye(){const{error:a,data:t}=await se();if(t){X.value=[];for(const s of t)X.value.push({label:s.name,value:s.id})}}const Y=r([]);async function we(){const{error:a,data:t}=await ue();if(t){Y.value=[];for(const s of t)Y.value.push({label:s.name,value:s.id})}}const re=r([{label:"待审核",value:1},{label:"审核驳回",value:2},{label:"审核通过",value:3}]);function Ie(){A(),v()}return C(),(a,t)=>{const s=De,F=We,E=ne,ie=Fe,Se=Me,qe=oe,Ne=le,ke=he,xe=be;return J(),je("div",Ze,[e(Ye,{model:u(b),"onUpdate:model":t[0]||(t[0]=m=>K(b)?b.value=m:null),onReset:Ie,onSearch:Q},null,8,["model"]),e(xe,{title:"数据列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[e(s,{columns:u(q),"onUpdate:columns":t[1]||(t[1]=m=>K(q)?q.value=m:null),"disabled-delete":u(g).length===0,loading:u(l),onAdd:O,onDelete:_,onRefresh:u(x)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:o(()=>[e(F,{"checked-row-keys":u(g),"onUpdate:checkedRowKeys":t[2]||(t[2]=m=>K(g)?g.value=m:null),columns:u(h),data:u($),size:"small","flex-height":!u(z).isMobile,"scroll-x":1088,loading:u(l),"row-key":m=>m.id,remote:"",pagination:u(R),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Xe,{visible:u(S),"onUpdate:visible":t[3]||(t[3]=m=>K(S)?S.value=m:null),"operate-type":p.value,"row-data":c.value,"all-pages":G.value,onSubmitted:u(D)},null,8,["visible","operate-type","row-data","all-pages","onSubmitted"]),e(ke,{show:w.value,"onUpdate:show":t[7]||(t[7]=m=>w.value=m),title:"预约审核",preset:"card",class:"w-600px"},{footer:o(()=>[e(Ne,{justify:"end",size:16},{default:o(()=>[e(u(M),{onClick:t[6]||(t[6]=m=>w.value=!1)},{default:o(()=>[U(P(u(I)("common.cancel")),1)]),_:1}),e(u(M),{type:"primary",onClick:L},{default:o(()=>[U(P(u(I)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[e(qe,{"label-placement":"left","label-width":100},{default:o(()=>[e(ie,{label:"预约状态：",required:""},{default:o(()=>[e(E,{value:f.value.auditStatus,"onUpdate:value":t[4]||(t[4]=m=>f.value.auditStatus=m),options:re.value,placeholder:"请选择预约状态"},null,8,["value","options"])]),_:1}),e(ie,{label:"审核描述：",required:""},{default:o(()=>[e(Se,{value:f.value.auditDesc,"onUpdate:value":t[5]||(t[5]=m=>f.value.auditDesc=m),type:"textarea",placeholder:"请输入审核描述",rows:4},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})])}}});export{dt as default};
