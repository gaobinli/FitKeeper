import{_ as ae,N as te}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BvwCvuJW.js";import{d as F,at as A,au as W,n as E,q as G,a as K,$ as u,r as M,av as ne,c as L,o as I,w as t,f as e,aw as le,z as H,s as oe,v as J,cJ as se,ax as re,x as Q,B,g as O,t as P,h as s,ay as ue,cK as ie,cL as pe,cM as ce,az as de,aA as me,L as X,E as _e,b as fe,aC as $,cN as V,cO as ve,O as he,aD as ge}from"./index-BAq2SbaD.js";import{u as be,a as we}from"./table-DmjEK7tG.js";import{_ as ye,a as ke,b as xe,c as Ne}from"./round-refresh-DNCv4Ss6.js";import{_ as Ue}from"./DataTable-D6rjIJFQ.js";import"./RadioGroup-BGb2VClf.js";import"./Pagination-PYMt0YJG.js";const De=F({name:"UserOperateDrawer",__name:"user-operate-drawer",props:A({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:A(["submitted"],["update:visible"]),setup(m,{emit:S}){const _=m,b=S,c=W(m,"visible"),{formRef:N,validate:i,restoreValidation:U}=E(),{defaultRequiredRule:w,patternRules:y}=G(),k=K(()=>({add:u("page.manage.user.addUser"),edit:u("page.manage.user.editUser")})[_.operateType]),a=M(v());function v(){return{id:null,username:"",password:"",name:"",phone:"",email:""}}const h={username:w,name:w,phone:[w,y.phone]};M([]);async function C(){}function D(){a.value=v(),_.operateType==="edit"&&_.rowData&&Object.assign(a.value,_.rowData),d()}async function d(){const{error:f,data:l}=await ie();if(l){x.value=[];for(const o of l)x.value.push({label:o.name,value:o.code})}}const x=M([]);function R(){c.value=!1}async function q(){var f;if(await i(),a.value.id){const{error:l,data:o}=await pe(a.value.id,a.value);if(l)return}else{a.value.password||(a.value.password=a.value.code);const{error:l,data:o}=await ce(a.value);if(l)return}(f=window.$message)==null||f.success(u("common.updateSuccess")),R(),b("submitted")}return ne(c,()=>{c.value&&(D(),U(),C())}),(f,l)=>{const o=J,n=oe,g=se,T=re,z=H,p=B,Y=Q,Z=le,ee=ue;return I(),L(ee,{show:c.value,"onUpdate:show":l[7]||(l[7]=r=>c.value=r),"display-directive":"show",width:360},{default:t(()=>[e(Z,{title:k.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(Y,{size:16},{default:t(()=>[e(p,{onClick:R},{default:t(()=>[O(P(s(u)("common.cancel")),1)]),_:1}),e(p,{type:"primary",onClick:q},{default:t(()=>[O(P(s(u)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(z,{ref_key:"formRef",ref:N,model:a.value,rules:h},{default:t(()=>[e(n,{label:"账号",path:"username"},{default:t(()=>[e(o,{value:a.value.username,"onUpdate:value":l[0]||(l[0]=r=>a.value.username=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(n,{label:"密码",path:"password"},{default:t(()=>[e(o,{value:a.value.password,"onUpdate:value":l[1]||(l[1]=r=>a.value.password=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(n,{label:"姓名",path:"name"},{default:t(()=>[e(o,{value:a.value.name,"onUpdate:value":l[2]||(l[2]=r=>a.value.name=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(n,{label:"手机号",path:"phone"},{default:t(()=>[e(o,{value:a.value.phone,"onUpdate:value":l[3]||(l[3]=r=>a.value.phone=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(n,{label:"邮箱",path:"email"},{default:t(()=>[e(o,{value:a.value.email,"onUpdate:value":l[4]||(l[4]=r=>a.value.email=r),placeholder:"请输入"},null,8,["value"])]),_:1}),e(n,{label:"状态",path:"enable"},{default:t(()=>[e(g,{value:a.value.enable,"onUpdate:value":l[5]||(l[5]=r=>a.value.enable=r)},null,8,["value"])]),_:1}),e(n,{label:"角色",path:"roles"},{default:t(()=>[e(T,{value:a.value.roleCodes,"onUpdate:value":l[6]||(l[6]=r=>a.value.roleCodes=r),multiple:"",options:x.value,placeholder:"请选择"},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Re=F({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:A(["reset","search"],["update:model"]),setup(m,{emit:S}){const _=S,{formRef:b,validate:c,restoreValidation:N}=E(),i=W(m,"model"),U=K(()=>{const{patternRules:k}=G();return{userEmail:k.email,userPhone:k.phone}});async function w(){await N(),_("reset")}async function y(){await c(),_("search")}return(k,a)=>{const v=J,h=me,C=xe,D=B,d=Ne,x=Q,R=de,q=H,f=ke,l=ye,o=X;return I(),L(o,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(l,{"default-expanded-names":["user-search"]},{default:t(()=>[e(f,{title:s(u)("common.search"),name:"user-search"},{default:t(()=>[e(q,{ref_key:"formRef",ref:b,model:i.value,rules:U.value,"label-placement":"left","label-width":80},{default:t(()=>[e(R,{responsive:"screen","item-responsive":""},{default:t(()=>[e(h,{span:"24 s:12 m:6",label:"账号",path:"qp_username_like",class:"pr-24px"},{default:t(()=>[e(v,{value:i.value.qp_username_like,"onUpdate:value":a[0]||(a[0]=n=>i.value.qp_username_like=n),placeholder:"请输入"},null,8,["value"])]),_:1}),e(h,{span:"24 s:12 m:6",label:"姓名",path:"qp_name_like",class:"pr-24px"},{default:t(()=>[e(v,{value:i.value.qp_name_like,"onUpdate:value":a[1]||(a[1]=n=>i.value.qp_name_like=n),placeholder:"请输入"},null,8,["value"])]),_:1}),e(h,{span:"24 s:12 m:6",label:"手机号",path:"userPhone",class:"pr-24px"},{default:t(()=>[e(v,{value:i.value.qp_phone_like,"onUpdate:value":a[2]||(a[2]=n=>i.value.qp_phone_like=n),placeholder:"请输入"},null,8,["value"])]),_:1}),e(h,{span:"24 m:6",class:"pr-24px"},{default:t(()=>[e(x,{class:"w-full",justify:"start"},{default:t(()=>[e(D,{onClick:w},{icon:t(()=>[e(C,{class:"text-icon"})]),default:t(()=>[O(" "+P(s(u)("common.reset")),1)]),_:1}),e(D,{type:"primary",ghost:"",onClick:y},{icon:t(()=>[e(d,{class:"text-icon"})]),default:t(()=>[O(" "+P(s(u)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Se={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function j(m){return typeof m=="function"||Object.prototype.toString.call(m)==="[object Object]"&&!ge(m)}const ze=F({name:"manage_user",__name:"index",setup(m){const S=_e(),{columns:_,columnChecks:b,data:c,getData:N,getDataByPage:i,loading:U,mobilePagination:w,searchParams:y,resetSearchParams:k}=be({apiFn:ve,showTotal:!0,apiParams:{current:1,size:10,qp_username_like:null,qp_name_like:null,qp_phone_like:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:u("common.index"),align:"center",width:64},{key:"username",title:"账号",align:"center",minWidth:100},{key:"name",title:"姓名",align:"center",minWidth:100},{key:"phone",title:"手机号",align:"center",minWidth:100},{key:"roleNames",title:"角色",align:"center",minWidth:100},{key:"email",title:"邮箱",align:"center",minWidth:200},{key:"enable",title:"状态",align:"center",width:100,render:o=>o.enable===null?null:e(he,{type:o.enable?"success":"warning"},{default:()=>[o.enable?"开启":"禁用"]})},{key:"operate",title:u("common.operate"),align:"center",width:130,render:o=>{let n;return e("div",{class:"flex-center gap-8px"},[e(B,{type:"primary",ghost:!0,size:"small",onClick:()=>l(o.id)},j(n=u("common.edit"))?n:{default:()=>[n]}),e(te,{onPositiveClick:()=>f(o.id)},{default:()=>u("common.confirmDelete"),trigger:()=>{let g;return e(B,{type:"error",ghost:!0,size:"small"},j(g=u("common.delete"))?g:{default:()=>[g]})}})])}}]}),{drawerVisible:a,operateType:v,editingData:h,handleAdd:C,handleEdit:D,checkedRowKeys:d,onBatchDeleted:x,onDeleted:R}=we(c,N);async function q(){const{error:o,data:n}=await V(d.value);console.log(d.value),x()}async function f(o){const{error:n,data:g}=await V(o);console.log(o),R()}function l(o){D(o)}return(o,n)=>{const g=ae,T=Ue,z=X;return I(),fe("div",Se,[e(Re,{model:s(y),"onUpdate:model":n[0]||(n[0]=p=>$(y)?y.value=p:null),onReset:s(k),onSearch:s(i)},null,8,["model","onReset","onSearch"]),e(z,{title:s(u)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[e(g,{columns:s(b),"onUpdate:columns":n[1]||(n[1]=p=>$(b)?b.value=p:null),"disabled-delete":s(d).length===0,loading:s(U),onAdd:s(C),onDelete:q,onRefresh:s(N)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:t(()=>[e(T,{"checked-row-keys":s(d),"onUpdate:checkedRowKeys":n[2]||(n[2]=p=>$(d)?d.value=p:null),columns:s(_),data:s(c),size:"small","flex-height":!s(S).isMobile,"scroll-x":962,loading:s(U),remote:"","row-key":p=>p.id,pagination:s(w),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(De,{visible:s(a),"onUpdate:visible":n[3]||(n[3]=p=>$(a)?a.value=p:null),"operate-type":s(v),"row-data":s(h),onSubmitted:s(i)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{ze as default};
