import{_ as ce,N as pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BvwCvuJW.js";import{d as A,at as V,m as G,au as Q,n as X,q as Y,a as Z,r as w,av as de,c as ee,o as L,w as n,f as e,aK as me,z as te,az as ne,aA as ae,v as le,ax as oe,aN as _e,x as se,B as M,g as z,t as F,h as s,$ as N,aL as fe,L as re,E as ve,ar as ge,b as ye,aC as $,aD as he}from"./index-BAq2SbaD.js";import{a as be,b as ke,c as K,d as we}from"./sku-DCZXQNbE.js";import{d as W}from"./category-DFWrO-xe.js";import{u as Ne,a as xe}from"./table-DmjEK7tG.js";import{W as Se}from"./WangEditor-BCwDbreK.js";import{_ as De}from"./Upload-DmXdhDTT.js";import{_ as qe,a as Ce,b as Ie,c as Ue}from"./round-refresh-DNCv4Ss6.js";import{_ as Re}from"./DataTable-D6rjIJFQ.js";import{_ as Te}from"./Image-Bgw24gBA.js";import"./wangEditor-CAqzKAJM.js";import"./RadioGroup-BGb2VClf.js";import"./Pagination-PYMt0YJG.js";const Oe=A({name:"SkuOperateModal",__name:"sku-operate-modal",props:V({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:V(["submitted"],["update:visible"]),setup(y,{emit:R}){const x="http://localhost:9000/upload";G();const h=y,T=R,d=Q(y,"visible"),{formRef:g,validate:C,restoreValidation:O}=X(),{defaultRequiredRule:i}=Y(),S=Z(()=>({add:"新增",edit:"编辑"})[h.operateType]),t=w(I());function I(){return{id:null,name:null,categoryId:null,url:null,price:null,simpleDesc:null,inventory:null,content:null,detail:null}}const c={id:i,name:i,categoryId:i,url:i,price:i,simpleDesc:i,inventory:i,content:i,detail:i};function m(){t.value=I(),h.operateType==="edit"&&h.rowData&&Object.assign(t.value,h.rowData),t.value.url&&(D.value=[{id:"1",name:"我是react.png",status:"finished",url:t.value.url}],t.value.url)}function b(){d.value=!1}async function k(){var r;if(await C(),t.value.id){const{error:a,data:p}=await be(t.value.id,t.value);if(a)return}else{const{error:a,data:p}=await ke(t.value);if(a)return}(r=window.$message)==null||r.success(N("common.updateSuccess")),b(),T("submitted")}de(d,()=>{d.value?(m(),O(),U()):D.value=[]});const D=w([]);function B(r){var a;r&&r.event&&((a=r.event)!=null&&a.target)&&r.event.target.response&&(t.value.url=JSON.parse(r.event.target.response).data),t.value.url&&(D.value=[{id:"1",name:"我是react.png",status:"finished",url:t.value.url}],t.value.url)}const q=w([]);async function U(){const{error:r,data:a}=await W();if(a){q.value=[];for(const p of a)q.value.push({label:p.name,value:p.id})}}const P=r=>{t.value.detail=r};return(r,a)=>{const p=le,_=ae,o=oe,l=De,u=_e,j=ne,E=te,f=me,H=M,ue=se,ie=fe;return L(),ee(ie,{show:d.value,"onUpdate:show":a[5]||(a[5]=v=>d.value=v),title:S.value,preset:"card",class:"w-800px"},{footer:n(()=>[e(ue,{justify:"end",size:16},{default:n(()=>[e(H,{onClick:b},{default:n(()=>[z(F(s(N)("common.cancel")),1)]),_:1}),e(H,{type:"primary",onClick:k},{default:n(()=>[z(F(s(N)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(f,{class:"h-480px pr-20px"},{default:n(()=>[e(E,{ref_key:"formRef",ref:g,model:t.value,rules:c,"label-placement":"left","label-width":100},{default:n(()=>[e(j,{responsive:"screen","item-responsive":""},{default:n(()=>[e(_,{span:"24 m:24",label:"美食：",path:"name"},{default:n(()=>[e(p,{value:t.value.name,"onUpdate:value":a[0]||(a[0]=v=>t.value.name=v),placeholder:"请输入名称"},null,8,["value"])]),_:1}),e(_,{span:"24 m:24",label:"分类：",path:"categoryId",class:"pr-24px"},{default:n(()=>[e(o,{value:t.value.categoryId,"onUpdate:value":a[1]||(a[1]=v=>t.value.categoryId=v),options:q.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(_,{span:"24 m:24",label:"封面：",path:"url"},{default:n(()=>[e(l,{action:x,"default-file-list":D.value,"list-type":"image-card",max:1,onChange:B},null,8,["default-file-list"])]),_:1}),e(_,{span:"24 m:24",label:"价格：",path:"price"},{default:n(()=>[e(u,{min:"1",value:t.value.price,"onUpdate:value":a[2]||(a[2]=v=>t.value.price=v),placeholder:"请输入价格"},null,8,["value"])]),_:1}),e(_,{span:"24 m:24",label:"库存量：",path:"inventory"},{default:n(()=>[e(u,{min:"1",value:t.value.inventory,"onUpdate:value":a[3]||(a[3]=v=>t.value.inventory=v),placeholder:"请输入库存量"},null,8,["value"])]),_:1}),e(_,{span:"24 m:24",label:"简单描述：",path:"simpleDesc"},{default:n(()=>[e(p,{value:t.value.simpleDesc,"onUpdate:value":a[4]||(a[4]=v=>t.value.simpleDesc=v),placeholder:"请输入简单描述"},null,8,["value"])]),_:1}),e(_,{span:"24 m:24",label:"美食介绍：",path:"detail"},{default:n(()=>[e(Se,{contentHtml:t.value.detail,onGetWangEditorValue:P},null,8,["contentHtml"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Be=A({name:"SkuSearch",__name:"sku-search",props:{model:{required:!0},modelModifiers:{}},emits:V(["reset","search"],["update:model"]),setup(y,{emit:R}){G();const x=R,{formRef:h,validate:T,restoreValidation:d}=X(),g=Q(y,"model"),C=Z(()=>{const{patternRules:c}=Y();return{userEmail:c.email,userPhone:c.phone}});async function O(){await d(),x("reset")}async function i(){await T(),x("search")}const S=w([]);async function t(){const{error:c,data:m}=await W();if(m){S.value=[];for(const b of m)S.value.push({label:b.name,value:b.id})}}function I(){t()}return I(),(c,m)=>{const b=le,k=ae,D=oe,B=Ie,q=M,U=Ue,P=se,r=ne,a=te,p=Ce,_=qe,o=re;return L(),ee(o,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(_,{"default-expanded-names":["sku-search"]},{default:n(()=>[e(p,{title:"搜索",name:"sku-search"},{default:n(()=>[e(a,{ref_key:"formRef",ref:h,model:g.value,rules:C.value,"label-placement":"left","label-width":80},{default:n(()=>[e(r,{responsive:"screen","item-responsive":""},{default:n(()=>[e(k,{span:"24 s:12 m:6",label:"美食：",path:"qp_name_like",class:"pr-24px"},{default:n(()=>[e(b,{value:g.value.qp_name_like,"onUpdate:value":m[0]||(m[0]=l=>g.value.qp_name_like=l),placeholder:"请输入"},null,8,["value"])]),_:1}),e(k,{span:"24 s:12 m:6",label:"分类：",path:"qp_categoryId_eq",class:"pr-24px"},{default:n(()=>[e(D,{value:g.value.qp_categoryId_eq,"onUpdate:value":m[1]||(m[1]=l=>g.value.qp_categoryId_eq=l),options:S.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(k,{span:"24 m:6",class:"pr-24px"},{default:n(()=>[e(P,{class:"w-full",justify:"start"},{default:n(()=>[e(q,{onClick:O},{icon:n(()=>[e(B,{class:"text-icon"})]),default:n(()=>[z(" "+F(s(N)("common.reset")),1)]),_:1}),e(q,{type:"primary",ghost:"",onClick:i},{icon:n(()=>[e(U,{class:"text-icon"})]),default:n(()=>[z(" "+F(s(N)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1})}}}),Pe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function J(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!he(y)}const Je=A({name:"sku",__name:"index",setup(y){const R=ve(),{bool:x,setTrue:h}=ge();G(),w(null);const{columns:T,columnChecks:d,data:g,loading:C,pagination:O,getData:i,getDataByPage:S,searchParams:t,resetSearchParams:I}=Ne({apiFn:we,apiParams:{currentPage:1,pageSize:10,qp_name_like:null,qp_categoryId_eq:null,qp_url_like:null,qp_price_like:null,qp_simpleDesc_like:null,qp_inventory_like:null,qp_content_like:null,qp_detail_like:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:"序号",align:"center"},{key:"name",title:"美食",align:"center"},{key:"categoryId",title:"分类",align:"center",render:o=>{if(o.categoryId){let l=[];for(const u of p.value)u.value===o.categoryId&&l.push(u.label);return l.join("、")}return""}},{key:"url",title:"封面",align:"center",render:o=>o.url===null?null:e(Te,{src:o.url,width:"100"},null)},{key:"price",title:"价格（元）",align:"center"},{key:"simpleDesc",title:"简单描述",align:"center"},{key:"inventory",title:"库存量",align:"center"},{key:"modifyUser",title:"修改人",align:"center"},{key:"modifyTime",title:"修改时间",width:154,align:"center",render:o=>o.modifyTime?o.modifyTime.replace("T"," "):""},{key:"operate",title:N("common.operate"),align:"center",width:230,render:o=>{let l;return e("div",{class:"flex-center justify-center gap-8px"},[e(M,{type:"primary",ghost:!0,size:"small",onClick:()=>P(o)},J(l=N("common.edit"))?l:{default:()=>[l]}),e(pe,{onPositiveClick:()=>q(o.id)},{default:()=>N("common.confirmDelete"),trigger:()=>{let u;return e(M,{type:"error",ghost:!0,size:"small"},J(u=N("common.delete"))?u:{default:()=>[u]})}})])}}]}),{checkedRowKeys:c,onBatchDeleted:m,onDeleted:b}=xe(g,i),k=w("add");function D(){k.value="add",h()}async function B(){const{error:o,data:l}=await K(c.value);console.log(c.value),m()}async function q(o){const{error:l,data:u}=await K(o);console.log(o),b()}const U=w(null);function P(o){k.value="edit",U.value={...o},h()}const r=w([]);function a(){_()}const p=w([]);async function _(){const{error:o,data:l}=await W();if(l){p.value=[];for(const u of l)p.value.push({label:u.name,value:u.id})}}return a(),(o,l)=>{const u=ce,j=Re,E=re;return L(),ye("div",Pe,[e(Be,{model:s(t),"onUpdate:model":l[0]||(l[0]=f=>$(t)?t.value=f:null),onReset:s(I),onSearch:s(S)},null,8,["model","onReset","onSearch"]),e(E,{title:"数据列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[e(u,{columns:s(d),"onUpdate:columns":l[1]||(l[1]=f=>$(d)?d.value=f:null),"disabled-delete":s(c).length===0,loading:s(C),onAdd:D,onDelete:B,onRefresh:s(i)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:n(()=>[e(j,{"checked-row-keys":s(c),"onUpdate:checkedRowKeys":l[2]||(l[2]=f=>$(c)?c.value=f:null),columns:s(T),data:s(g),size:"small","flex-height":!s(R).isMobile,"scroll-x":1088,loading:s(C),"row-key":f=>f.id,remote:"",pagination:s(O),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Oe,{visible:s(x),"onUpdate:visible":l[3]||(l[3]=f=>$(x)?x.value=f:null),"operate-type":k.value,"row-data":U.value,"all-pages":r.value,onSubmitted:s(S)},null,8,["visible","operate-type","row-data","all-pages","onSubmitted"])]),_:1})])}}});export{Je as default};
