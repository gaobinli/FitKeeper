import{N as _e,_ as ge}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BvwCvuJW.js";import{c as M,b as fe,g as ve,h as he}from"./auth-dh_SfOdj.js";import{r as $,a as F,$ as t,ar as L,as as be,d as Y,at as q,au as ae,n as te,q as le,av as ye,c as z,o as T,w as n,f as a,aw as ke,z as ne,h as e,s as Ne,v as se,b as H,P as Q,Q as X,ax as oe,x as re,B as A,g as I,t as V,ay as we,az as De,aA as Ue,aB as J,L as ue,E as xe,p as Se,O as Z,aC as W,aD as Re}from"./index-BAq2SbaD.js";import{u as ie,e as pe,a as Ce,b as Pe}from"./business-eDIdtQAr.js";import{_ as Ee,a as Ge}from"./RadioGroup-BGb2VClf.js";import{_ as Be,a as Te,b as Me,c as Oe}from"./round-refresh-DNCv4Ss6.js";import{_ as $e}from"./DataTable-D6rjIJFQ.js";import"./Pagination-PYMt0YJG.js";function ze(){return M.Get("/systemManage/getAllRoles")}function Fe(o){return M.Get("/systemManage/getUserList",{params:o})}function Ae(o){return M.Post("/systemManage/addUser",o)}function Ie(o){return M.Post("/systemManage/updateUser",o)}function Ve(o){return M.Delete("/systemManage/deleteUser",{id:o})}function Ke(o){return M.Delete("/systemManage/batchDeleteUser",{ids:o})}function ee(o){return!!o.key}function je(o){const k="__selection__",g="__expand__",f=$((r=>{const d=[];return r.forEach(v=>{ee(v)?d.push({key:v.key,title:v.title,checked:!0}):v.type==="selection"?d.push({key:k,title:t("common.check"),checked:!0}):v.type==="expand"&&d.push({key:g,title:t("common.expandColumn"),checked:!0})}),d})(o())),C=F(()=>{const r=o(),d=new Map;return r.forEach(m=>{ee(m)?d.set(m.key,m):m.type==="selection"?d.set(k,m):m.type==="expand"&&d.set(g,m)}),f.value.filter(m=>m.checked).map(m=>d.get(m.key))});return{columnChecks:f,columns:C}}function Le(o,k){const{bool:g,setTrue:x,setFalse:f}=L(),{bool:C,setTrue:r,setFalse:d}=L(),{bool:v,setTrue:m,setFalse:G}=L(),U=$("add"),c=w=>o.value.find(h=>h.id===w)||null;function s(){U.value="add",x()}const N=$(null);function P(w){U.value="edit",N.value=be(c(w)),x()}const S=$([]);async function E(){var w,h;m();try{const R=S.value.map(_=>c(_)).filter(Boolean);await((w=k.batchDelete)==null?void 0:w.call(k,R)),(h=window.$message)==null||h.success(t("common.deleteSuccess")),S.value=[]}finally{G()}}async function B(w){var R,_;r();const h=c(w);if(h)try{await((R=k.delete)==null?void 0:R.call(k,h)),(_=window.$message)==null||_.success(t("common.deleteSuccess")),S.value=[]}finally{d()}}return{drawerVisible:g,openDrawer:x,closeDrawer:f,operateType:U,handleAdd:s,editingData:N,handleEdit:P,checkedRowKeys:S,deleting:C,handleDelete:B,batchDeleting:v,handleBatchDelete:E}}const We=Y({name:"UserOperateDrawer",__name:"user-operate-drawer",props:q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:q(["submitted"],["update:visible"]),setup(o,{emit:k}){const g=o,x=k,f=ae(o,"visible"),{formRef:C,validate:r,restoreValidation:d}=te(),{defaultRequiredRule:v}=le(),m=F(()=>({add:t("page.manage.user.addUser"),edit:t("page.manage.user.editUser")})[g.operateType]),{loading:G,reset:U,send:c,form:s,updateForm:N}=fe(_=>g.operateType==="add"?Ae(_):Ie(_),{initialForm:{userName:"",userGender:null,nickName:"",userPhone:"",userEmail:"",userRoles:[],status:null},resetAfterSubmiting:!0}),P={userName:v,status:v},{data:S,loading:E}=ve(ze,[f],{initialData:[],middleware(_,u){return f.value?u():void 0}}),B=F(()=>{const _=S.value.map(D=>({label:D.roleName,value:D.roleCode}));return[...s.value.userRoles.map(D=>({label:D,value:D})),..._]});function w(){g.operateType==="edit"&&g.rowData?N(g.rowData):g.operateType==="add"&&U()}function h(){f.value=!1}async function R(){var _;await r(),await c(),(_=window.$message)==null||_.success(t("common.updateSuccess")),h(),x("submitted")}return ye(f,()=>{f.value&&(d(),w())}),(_,u)=>{const D=se,l=Ne,i=Ge,b=Ee,K=oe,j=ne,y=A,de=re,ce=ke,me=we;return T(),z(me,{show:f.value,"onUpdate:show":u[7]||(u[7]=p=>f.value=p),"display-directive":"show",width:360},{default:n(()=>[a(ce,{title:m.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[a(de,{size:16},{default:n(()=>[a(y,{onClick:h},{default:n(()=>[I(V(e(t)("common.cancel")),1)]),_:1}),a(y,{type:"primary",loading:e(G),onClick:R},{default:n(()=>[I(V(e(t)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:n(()=>[a(j,{ref_key:"formRef",ref:C,model:e(s),rules:P},{default:n(()=>[a(l,{label:e(t)("page.manage.user.userName"),path:"userName"},{default:n(()=>[a(D,{value:e(s).userName,"onUpdate:value":u[0]||(u[0]=p=>e(s).userName=p),placeholder:e(t)("page.manage.user.form.userName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userGender"),path:"userGender"},{default:n(()=>[a(b,{value:e(s).userGender,"onUpdate:value":u[1]||(u[1]=p=>e(s).userGender=p)},{default:n(()=>[(T(!0),H(Q,null,X(e(ie),p=>(T(),z(i,{key:p.value,value:p.value,label:e(t)(p.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.nickName"),path:"nickName"},{default:n(()=>[a(D,{value:e(s).nickName,"onUpdate:value":u[2]||(u[2]=p=>e(s).nickName=p),placeholder:e(t)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userPhone"),path:"userPhone"},{default:n(()=>[a(D,{value:e(s).userPhone,"onUpdate:value":u[3]||(u[3]=p=>e(s).userPhone=p),placeholder:e(t)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userEmail"),path:"email"},{default:n(()=>[a(D,{value:e(s).userEmail,"onUpdate:value":u[4]||(u[4]=p=>e(s).userEmail=p),placeholder:e(t)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userStatus"),path:"status"},{default:n(()=>[a(b,{value:e(s).status,"onUpdate:value":u[5]||(u[5]=p=>e(s).status=p)},{default:n(()=>[(T(!0),H(Q,null,X(e(pe),p=>(T(),z(i,{key:p.value,value:p.value,label:e(t)(p.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userRole"),path:"roles"},{default:n(()=>[a(K,{value:e(s).userRoles,"onUpdate:value":u[6]||(u[6]=p=>e(s).userRoles=p),multiple:"",loading:e(E),options:B.value,placeholder:e(t)("page.manage.user.form.userRole")},null,8,["value","loading","options","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),qe=Y({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["search"],["update:model"]),setup(o,{emit:k}){const g=k,{formRef:x,validate:f,restoreValidation:C}=te(),r=ae(o,"model"),d={...r.value},v=F(()=>{const{patternRules:U}=le();return{userEmail:U.email,userPhone:U.phone}});async function m(){await C(),Object.assign(r.value,d)}async function G(){await f(),g("search")}return(U,c)=>{const s=se,N=Ue,P=oe,S=Me,E=A,B=Oe,w=re,h=De,R=ne,_=Te,u=Be,D=ue;return T(),z(D,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(u,{"default-expanded-names":["user-search"]},{default:n(()=>[a(_,{title:e(t)("common.search"),name:"user-search"},{default:n(()=>[a(R,{ref_key:"formRef",ref:x,model:r.value,rules:v.value,"label-placement":"left","label-width":80},{default:n(()=>[a(h,{responsive:"screen","item-responsive":""},{default:n(()=>[a(N,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userName"),path:"userName",class:"pr-24px"},{default:n(()=>[a(s,{value:r.value.userName,"onUpdate:value":c[0]||(c[0]=l=>r.value.userName=l),placeholder:e(t)("page.manage.user.form.userName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(N,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userGender"),path:"userGender",class:"pr-24px"},{default:n(()=>[a(P,{value:r.value.userGender,"onUpdate:value":c[1]||(c[1]=l=>r.value.userGender=l),placeholder:e(t)("page.manage.user.form.userGender"),options:e(J)(e(ie)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(N,{span:"24 s:12 m:6",label:e(t)("page.manage.user.nickName"),path:"nickName",class:"pr-24px"},{default:n(()=>[a(s,{value:r.value.nickName,"onUpdate:value":c[2]||(c[2]=l=>r.value.nickName=l),placeholder:e(t)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(N,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userPhone"),path:"userPhone",class:"pr-24px"},{default:n(()=>[a(s,{value:r.value.userPhone,"onUpdate:value":c[3]||(c[3]=l=>r.value.userPhone=l),placeholder:e(t)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(N,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userEmail"),path:"userEmail",class:"pr-24px"},{default:n(()=>[a(s,{value:r.value.userEmail,"onUpdate:value":c[4]||(c[4]=l=>r.value.userEmail=l),placeholder:e(t)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(N,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userStatus"),path:"userStatus",class:"pr-24px"},{default:n(()=>[a(P,{value:r.value.status,"onUpdate:value":c[5]||(c[5]=l=>r.value.status=l),placeholder:e(t)("page.manage.user.form.userStatus"),options:e(J)(e(pe)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(N,{span:"24 m:12",class:"pr-24px"},{default:n(()=>[a(w,{class:"w-full",justify:"end"},{default:n(()=>[a(E,{onClick:m},{icon:n(()=>[a(S,{class:"text-icon"})]),default:n(()=>[I(" "+V(e(t)("common.reset")),1)]),_:1}),a(E,{type:"primary",ghost:"",onClick:G},{icon:n(()=>[a(B,{class:"text-icon"})]),default:n(()=>[I(" "+V(e(t)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),He={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function O(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!Re(o)}const la=Y({name:"alova_user",__name:"index",setup(o){const k=xe(),g=Se({status:null,userName:null,userGender:null,nickName:null,userPhone:null,userEmail:null}),{loading:x,data:f,refresh:C,reload:r,page:d,pageSize:v,pageCount:m,send:G,remove:U}=he((l,i)=>Fe({...g,current:l,size:i}),{data:({records:l})=>l,total:({total:l})=>l,watchingStates:[g],debounce:[1e3]}),c=(l=1)=>{d.value=l,G(d.value,v.value)},{drawerVisible:s,operateType:N,editingData:P,handleAdd:S,handleEdit:E,handleDelete:B,handleBatchDelete:w,checkedRowKeys:h,deleting:R}=Le(f,{async delete(l){await Ve(l.id),U(l)},async batchDelete(l){await Ke(l.map(({id:i})=>i)),U(...l)}});function _(l){E(l)}const{columnChecks:u,columns:D}=je(()=>[{type:"selection",align:"center",width:48},{key:"userName",title:t("page.manage.user.userName"),align:"center",minWidth:100},{key:"userGender",title:t("page.manage.user.userGender"),align:"center",width:100,render:l=>{if(l.userGender===null)return null;const i={1:"primary",2:"error"},b=t(Ce[l.userGender]);return a(Z,{type:i[l.userGender]},O(b)?b:{default:()=>[b]})}},{key:"nickName",title:t("page.manage.user.nickName"),align:"center",minWidth:100},{key:"userPhone",title:t("page.manage.user.userPhone"),align:"center",width:120},{key:"userEmail",title:t("page.manage.user.userEmail"),align:"center",minWidth:200},{key:"status",title:t("page.manage.user.userStatus"),align:"center",width:100,render:l=>{if(l.status===null)return null;const i={1:"success",2:"warning"},b=t(Pe[l.status]);return a(Z,{type:i[l.status]},O(b)?b:{default:()=>[b]})}},{key:"operate",title:t("common.operate"),align:"center",width:130,render:l=>{let i;return a("div",{class:"flex-center gap-8px"},[a(A,{type:"primary",ghost:!0,size:"small",onClick:()=>_(l.id)},O(i=t("common.edit"))?i:{default:()=>[i]}),a(_e,{onPositiveClick:()=>B(l.id),positiveButtonProps:{loading:R.value}},{default:()=>t("common.confirmDelete"),trigger:()=>{let b;return a(A,{type:"error",ghost:!0,size:"small"},O(b=t("common.delete"))?b:{default:()=>[b]})}})])}}]);return(l,i)=>{const b=ge,K=$e,j=ue;return T(),H("div",He,[a(qe,{model:g,"onUpdate:model":i[0]||(i[0]=y=>g=y),onSearch:c},null,8,["model"]),a(j,{title:e(t)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(b,{columns:e(u),"onUpdate:columns":i[1]||(i[1]=y=>W(u)?u.value=y:null),"disabled-delete":e(h).length===0,loading:e(x),onAdd:e(S),onDelete:e(w),onRefresh:e(C)},null,8,["columns","disabled-delete","loading","onAdd","onDelete","onRefresh"])]),default:n(()=>[a(K,{"checked-row-keys":e(h),"onUpdate:checkedRowKeys":i[2]||(i[2]=y=>W(h)?h.value=y:null),columns:e(D),data:e(f),size:"small","flex-height":!e(k).isMobile,"scroll-x":962,loading:e(x),remote:"","row-key":y=>y.id,pagination:{page:e(d),pageSize:e(v),showSizePicker:!0,pageCount:e(m),pageSizes:[10,15,20,25,30],onUpdatePage(y){d.value=y},onUpdatePageSize(y){v.value=y}},class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(We,{visible:e(s),"onUpdate:visible":i[3]||(i[3]=y=>W(s)?s.value=y:null),"operate-type":e(N),"row-data":e(P),onSubmitted:e(r)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{la as default};
