import{C as K,ar as F,p as N,as as M,r as v,a as O,cu as L,E as $,$ as E,av as A,l as H}from"./index-BAq2SbaD.js";function U(s){const{loading:d,startLoading:y,endLoading:i}=K(),{bool:b,setBool:m}=F(),{apiFn:z,apiParams:u,transformer:S,immediate:g=!0,getColumnChecks:C,getColumns:x}=s,n=N(M({...u})),h=v(s.columns()),P=v([]),f=v(C(s.columns())),w=O(()=>x(h.value,f.value));function _(){h.value=s.columns();const r=new Map(f.value.map(e=>[e.key,e.checked])),l=C(h.value);f.value=l.map(e=>({...e,checked:r.get(e.key)??e.checked}))}async function k(){var a;y();const r=D(n),l=await z(r),e=S(l);P.value=e.data,m(e.data.length===0),await((a=s.onFetched)==null?void 0:a.call(s,e)),i()}function D(r){const l={};return Object.entries(r).forEach(([e,a])=>{a!=null&&(l[e]=a)}),l}function c(r){Object.assign(n,r)}function T(){Object.assign(n,M(u))}return g&&k(),{loading:d,empty:b,data:P,columns:w,columnChecks:f,reloadColumns:_,getData:k,searchParams:n,updateSearchParams:c,resetSearchParams:T}}function R(s){const d=L(),y=$(),i=O(()=>y.isMobile),{apiFn:b,apiParams:m,immediate:z,showTotal:u}=s,S="__selection__",g="__expand__",{loading:C,empty:x,data:n,columns:h,columnChecks:P,reloadColumns:f,getData:w,searchParams:_,updateSearchParams:k,resetSearchParams:D}=U({apiFn:b,apiParams:m,columns:s.columns,transformer:e=>{let{list:a=[],currentPage:t=1,pageSize:p=10,totalCount:o=0}=e.data||{};return p=p<=0?10:p,{data:a.map((j,I)=>({...j,index:(t-1)*p+I+1})),pageNum:t,pageSize:p,totalCount:o}},getColumnChecks:e=>{const a=[];return e.forEach(t=>{B(t)?a.push({key:t.key,title:t.title,checked:!0}):t.type==="selection"?a.push({key:S,title:E("common.check"),checked:!0}):t.type==="expand"&&a.push({key:g,title:E("common.expandColumn"),checked:!0})}),a},getColumns:(e,a)=>{const t=new Map;return e.forEach(o=>{B(o)?t.set(o.key,o):o.type==="selection"?t.set(S,o):o.type==="expand"&&t.set(g,o)}),a.filter(o=>o.checked).map(o=>t.get(o.key))},onFetched:async e=>{const{pageNum:a,pageSize:t,totalCount:p}=e;r({page:a,pageSize:t,itemCount:p})},immediate:z}),c=N({page:1,pageSize:10,showSizePicker:!0,pageSizes:[10,15,20,25,30],onUpdatePage:async e=>{c.page=e,k({currentPage:e,pageSize:c.pageSize}),w()},onUpdatePageSize:async e=>{c.pageSize=e,c.page=1,k({currentPage:pageNum,pageSize:c.pageSize}),w()},...u?{prefix:e=>E("datatable.itemCount",{total:e.itemCount})}:{}}),T=O(()=>({...c,pageSlot:i.value?3:9,prefix:!i.value&&u?c.prefix:void 0}));function r(e){Object.assign(c,e)}async function l(e=1){r({page:e}),k({currentPage:e,pageSize:c.pageSize}),await w()}return d.run(()=>{A(()=>y.locale,()=>{f()})}),H(()=>{d.stop()}),{loading:C,empty:x,data:n,columns:h,columnChecks:P,reloadColumns:f,pagination:c,mobilePagination:T,updatePagination:r,getData:w,getDataByPage:l,searchParams:_,updateSearchParams:k,resetSearchParams:D}}function V(s,d){const{bool:y,setTrue:i,setFalse:b}=F(),m=v("add");function z(){m.value="add",i()}const u=v(null);function S(n){m.value="edit";const h=s.value.find(P=>P.id===n)||null;u.value=M(h),i()}const g=v([]);async function C(){var n;(n=window.$message)==null||n.success(E("common.deleteSuccess")),g.value=[],await d()}async function x(){var n;(n=window.$message)==null||n.success(E("common.deleteSuccess")),await d()}return{drawerVisible:y,openDrawer:i,closeDrawer:b,operateType:m,handleAdd:z,editingData:u,handleEdit:S,checkedRowKeys:g,onBatchDeleted:C,onDeleted:x}}function B(s){return!!s.key}export{V as a,R as u};
