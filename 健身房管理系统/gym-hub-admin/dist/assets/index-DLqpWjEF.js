import{_ as Z,N as ee}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BvwCvuJW.js";import{d as A,at as F,au as K,n as te,q as oe,ar as W,a as I,$ as u,r as j,av as ne,c as H,o as V,w as t,f as e,aw as ae,z as L,s as le,v as J,ax as se,x as Q,B as M,g as P,t as q,h as o,ay as ie,bG as X,bH as re,bI as ue,az as ce,aA as de,L as Y,E as me,b as pe,aC as $,bJ as G,bK as _e,aD as fe}from"./index-BAq2SbaD.js";import{u as ve,a as he}from"./table-DmjEK7tG.js";import{_ as ge,a as be,b as ye,c as we}from"./round-refresh-DNCv4Ss6.js";import{_ as ke}from"./DataTable-D6rjIJFQ.js";import"./RadioGroup-BGb2VClf.js";import"./Pagination-PYMt0YJG.js";const Ne=A({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:F({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:F(["submitted"],["update:visible"]),setup(_,{emit:D}){const c=_,d=D,p=K(_,"visible"),{formRef:N,validate:C,restoreValidation:f}=te(),{defaultRequiredRule:w}=oe();W(),W();const v=I(()=>({add:u("page.manage.role.addRole"),edit:u("page.manage.role.editRole")})[c.operateType]),l=j(h());function h(){return{id:null,name:"",code:"",menuCodes:[]}}const R={name:w,code:w};I(()=>{var r;return((r=c.rowData)==null?void 0:r.id)||-1}),I(()=>c.operateType==="edit");function S(){l.value=h(),c.operateType==="edit"&&c.rowData&&Object.assign(l.value,c.rowData),B()}async function B(){const{error:r,data:a}=await X();if(a){k.value=[];for(const g of a)k.value.push({label:g.name,value:g.code})}}const k=j([]);function m(){p.value=!1}async function O(){var r;if(await C(),l.value.id){const{error:a,data:g}=await re(l.value.id,l.value);if(a)return}else{const{error:a,data:g}=await ue(l.value);if(a)return}(r=window.$message)==null||r.success(u("common.updateSuccess")),m(),d("submitted")}return ne(p,()=>{p.value&&(S(),f())}),(r,a)=>{const g=J,T=le,x=se,z=L,s=M,n=Q,i=ae,U=ie;return V(),H(U,{show:p.value,"onUpdate:show":a[3]||(a[3]=b=>p.value=b),"display-directive":"show",width:360},{default:t(()=>[e(i,{title:v.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(n,{size:16},{default:t(()=>[e(s,{onClick:m},{default:t(()=>[P(q(o(u)("common.cancel")),1)]),_:1}),e(s,{type:"primary",onClick:O},{default:t(()=>[P(q(o(u)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(z,{ref_key:"formRef",ref:N,model:l.value,rules:R},{default:t(()=>[e(T,{label:"角色名称",path:"name"},{default:t(()=>[e(g,{value:l.value.name,"onUpdate:value":a[0]||(a[0]=b=>l.value.name=b),placeholder:"请输入"},null,8,["value"])]),_:1}),e(T,{label:"角色编码",path:"code"},{default:t(()=>[e(g,{value:l.value.code,"onUpdate:value":a[1]||(a[1]=b=>l.value.code=b),placeholder:"请输入"},null,8,["value"])]),_:1}),e(T,{label:"菜单",path:"menuCodes"},{default:t(()=>[e(x,{value:l.value.menuCodes,"onUpdate:value":a[2]||(a[2]=b=>l.value.menuCodes=b),multiple:"",filterable:!0,options:k.value,placeholder:r.请选择},null,8,["value","options","placeholder"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),xe=A({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:F(["reset","search"],["update:model"]),setup(_,{emit:D}){const c=D,d=K(_,"model");function p(){c("reset")}function N(){c("search")}return(C,f)=>{const w=J,v=de,l=ye,h=M,R=we,S=Q,B=ce,k=L,m=be,O=ge,r=Y;return V(),H(r,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(O,{"default-expanded-names":["role-search"]},{default:t(()=>[e(m,{title:o(u)("common.search"),name:"role-search"},{default:t(()=>[e(k,{model:d.value,"label-placement":"left","label-width":80},{default:t(()=>[e(B,{responsive:"screen","item-responsive":""},{default:t(()=>[e(v,{span:"24 s:12 m:6",label:"角色名称",path:"qp_name_like",class:"pr-24px"},{default:t(()=>[e(w,{value:d.value.qp_name_like,"onUpdate:value":f[0]||(f[0]=a=>d.value.qp_name_like=a),placeholder:"请输入"},null,8,["value"])]),_:1}),e(v,{span:"24 s:12 m:6",label:"角色编码",path:"qp_code_like",class:"pr-24px"},{default:t(()=>[e(w,{value:d.value.qp_code_like,"onUpdate:value":f[1]||(f[1]=a=>d.value.qp_code_like=a),placeholder:"请输入"},null,8,["value"])]),_:1}),e(v,{span:"24 s:12 m:6"},{default:t(()=>[e(S,{class:"w-full",justify:"start"},{default:t(()=>[e(h,{onClick:p},{icon:t(()=>[e(l,{class:"text-icon"})]),default:t(()=>[P(" "+q(o(u)("common.reset")),1)]),_:1}),e(h,{type:"primary",ghost:"",onClick:N},{icon:t(()=>[e(R,{class:"text-icon"})]),default:t(()=>[P(" "+q(o(u)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),De={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function E(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!fe(_)}const $e=A({name:"manage_role",__name:"index",setup(_){const D=me(),{columns:c,columnChecks:d,data:p,loading:N,getData:C,getDataByPage:f,mobilePagination:w,searchParams:v,resetSearchParams:l}=ve({apiFn:_e,apiParams:{current:1,size:10},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"ID",width:64,align:"center"},{key:"code",title:"角色编码",align:"center",minWidth:120},{key:"name",title:"角色名称",align:"center",minWidth:120},{key:"menuCodes",title:"菜单",align:"center",minWidth:120,render:s=>{if(s.menuCodes){let n=[];for(const i of x.value)for(const U of s.menuCodes)i.value===U&&n.push(i.label);return n.join("、")}return""}},{key:"modifyUser",title:"修改人",minWidth:120},{key:"modifyTime",title:"修改时间",minWidth:120},{key:"operate",title:u("common.operate"),align:"center",width:130,render:s=>{let n;return e("div",{class:"flex-center gap-8px"},[e(M,{type:"primary",ghost:!0,size:"small",onClick:()=>T(s.id)},E(n=u("common.edit"))?n:{default:()=>[n]}),e(ee,{onPositiveClick:()=>g(s.id)},{default:()=>u("common.confirmDelete"),trigger:()=>{let i;return e(M,{type:"error",ghost:!0,size:"small"},E(i=u("common.delete"))?i:{default:()=>[i]})}})])}}]}),{drawerVisible:h,operateType:R,editingData:S,handleAdd:B,handleEdit:k,checkedRowKeys:m,onBatchDeleted:O,onDeleted:r}=he(p,C);async function a(){const{error:s,data:n}=await G(m.value);console.log(m.value),O()}async function g(s){const{error:n,data:i}=await G(s);console.log(s),r()}function T(s){k(s)}const x=j([]);async function z(){const{error:s,data:n}=await X();if(n){x.value=[];for(const i of n)x.value.push({label:i.name,value:i.code}),console.log("menuOptions========>",x.value)}}return z(),(s,n)=>{const i=Z,U=ke,b=Y;return V(),pe("div",De,[e(xe,{model:o(v),"onUpdate:model":n[0]||(n[0]=y=>$(v)?v.value=y:null),onReset:o(l),onSearch:o(f)},null,8,["model","onReset","onSearch"]),e(b,{title:o(u)("page.manage.role.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[e(i,{columns:o(d),"onUpdate:columns":n[1]||(n[1]=y=>$(d)?d.value=y:null),"disabled-delete":o(m).length===0,loading:o(N),onAdd:o(B),onDelete:a,onRefresh:o(C)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:t(()=>[e(U,{"checked-row-keys":o(m),"onUpdate:checkedRowKeys":n[2]||(n[2]=y=>$(m)?m.value=y:null),columns:o(c),data:o(p),size:"small","flex-height":!o(D).isMobile,"scroll-x":702,loading:o(N),remote:"","row-key":y=>y.id,pagination:o(w),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ne,{visible:o(h),"onUpdate:visible":n[3]||(n[3]=y=>$(h)?h.value=y:null),"operate-type":o(R),"row-data":o(S),onSubmitted:o(f)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{$e as default};
