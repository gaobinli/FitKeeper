import{_ as me,N as pe}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BvwCvuJW.js";import{aI as G,aJ as de,d as K,at as W,m as J,au as ee,n as te,q as oe,a as ne,r as d,av as fe,c as ae,o as Q,w as n,f as e,aK as _e,z as se,az as le,aA as re,ax as ie,x as ue,B as L,g as V,t as A,h as i,$ as w,aL as ve,L as ce,E as he,ar as ge,b as be,aC as E,aD as ye}from"./index-BAq2SbaD.js";import{f as M}from"./user-CToCrV-S.js";import{d as X}from"./post-C8zjaOhA.js";import{u as we,a as Ce}from"./table-DmjEK7tG.js";import{W as xe}from"./WangEditor-BCwDbreK.js";import{_ as Ie,a as ke,b as Ne,c as Oe}from"./round-refresh-DNCv4Ss6.js";import{_ as qe}from"./DataTable-D6rjIJFQ.js";import"./wangEditor-CAqzKAJM.js";import"./RadioGroup-BGb2VClf.js";import"./Pagination-PYMt0YJG.js";function Pe(u){return G({url:de("/postComment",u),method:"get"})}function Se(u){return G({url:"/postComment",method:"post",data:u})}function De(u,I){return G({url:"/postComment/"+u,method:"patch",data:I})}function Y(u){return G({url:"/postComment/"+u,method:"delete"})}const Re=K({name:"PostCommentOperateModal",__name:"postComment-operate-modal",props:W({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:W(["submitted"],["update:visible"]),setup(u,{emit:I}){J();const _=u,R=I,b=ee(u,"visible"),{formRef:k,validate:v,restoreValidation:T}=te(),{defaultRequiredRule:C}=oe(),U=ne(()=>({add:"新增",edit:"编辑"})[_.operateType]),a=d(x());function x(){return{id:null,postId:null,commentContent:null,userId:null,commentId:null}}const N={id:C,postId:C,commentContent:C,userId:C};function h(){a.value=x(),_.operateType==="edit"&&_.rowData&&Object.assign(a.value,_.rowData),a.value.url&&(q.value=[{id:"1",name:"我是react.png",status:"finished",url:a.value.url}],a.value.url)}function O(){b.value=!1}async function j(){var p;if(await v(),a.value.id){const{error:s,data:r}=await De(a.value.id,a.value);if(s)return}else{const{error:s,data:r}=await Se(a.value);if(s)return}(p=window.$message)==null||p.success(w("common.updateSuccess")),O(),R("submitted")}fe(b,()=>{b.value&&(h(),T(),c(),z(),$())});const q=d([]),f=d([]);async function c(){const{error:p,data:s}=await X();if(s){f.value=[];for(const r of s)f.value.push({label:r.title,value:r.id})}}const m=p=>{a.value.commentContent=p},g=d([]);async function z(){const{error:p,data:s}=await M();if(s){g.value=[];for(const r of s)g.value.push({label:r.name,value:r.id})}}const P=d([]);async function $(){const{error:p,data:s}=await M();if(s){P.value=[];for(const r of s)P.value.push({label:r.name,value:r.id})}}return(p,s)=>{const r=ie,S=re,B=le,F=se,o=_e,t=L,l=ue,H=ve;return Q(),ae(H,{show:b.value,"onUpdate:show":s[2]||(s[2]=D=>b.value=D),title:U.value,preset:"card",class:"w-800px"},{footer:n(()=>[e(l,{justify:"end",size:16},{default:n(()=>[e(t,{onClick:O},{default:n(()=>[V(A(i(w)("common.cancel")),1)]),_:1}),e(t,{type:"primary",onClick:j},{default:n(()=>[V(A(i(w)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[e(o,{class:"h-480px pr-20px"},{default:n(()=>[e(F,{ref_key:"formRef",ref:k,model:a.value,rules:N,"label-placement":"left","label-width":100},{default:n(()=>[e(B,{responsive:"screen","item-responsive":""},{default:n(()=>[e(S,{span:"24 m:24",label:"帖子：",path:"postId",class:"pr-24px"},{default:n(()=>[e(r,{value:a.value.postId,"onUpdate:value":s[0]||(s[0]=D=>a.value.postId=D),options:f.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(S,{span:"24 m:24",label:"评论人：",path:"userId",class:"pr-24px"},{default:n(()=>[e(r,{value:a.value.userId,"onUpdate:value":s[1]||(s[1]=D=>a.value.userId=D),options:g.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(S,{span:"24 m:24",label:"评论内容：",path:"commentContent"},{default:n(()=>[e(xe,{contentHtml:a.value.commentContent,onGetWangEditorValue:m},null,8,["contentHtml"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Te=K({name:"PostCommentSearch",__name:"postComment-search",props:{model:{required:!0},modelModifiers:{}},emits:W(["reset","search"],["update:model"]),setup(u,{emit:I}){J();const _=I,{formRef:R,validate:b,restoreValidation:k}=te(),v=ee(u,"model"),T=ne(()=>{const{patternRules:f}=oe();return{userEmail:f.email,userPhone:f.phone}});async function C(){await k(),_("reset")}async function U(){await b(),_("search")}const a=d([]);async function x(){const{error:f,data:c}=await X();if(c){a.value=[];for(const m of c)a.value.push({label:m.title,value:m.id})}}const N=d([]);async function h(){const{error:f,data:c}=await M();if(c){N.value=[];for(const m of c)N.value.push({label:m.name,value:m.id})}}const O=d([]);async function j(){const{error:f,data:c}=await M();if(c){O.value=[];for(const m of c)O.value.push({label:m.name,value:m.id})}}function q(){x(),h(),j()}return q(),(f,c)=>{const m=ie,g=re,z=Ne,P=L,$=Oe,p=ue,s=le,r=se,S=ke,B=Ie,F=ce;return Q(),ae(F,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[e(B,{"default-expanded-names":["postComment-search"]},{default:n(()=>[e(S,{title:"搜索",name:"postComment-search"},{default:n(()=>[e(r,{ref_key:"formRef",ref:R,model:v.value,rules:T.value,"label-placement":"left","label-width":80},{default:n(()=>[e(s,{responsive:"screen","item-responsive":""},{default:n(()=>[e(g,{span:"24 s:12 m:6",label:"帖子：",path:"qp_postId_eq",class:"pr-24px"},{default:n(()=>[e(m,{value:v.value.qp_postId_eq,"onUpdate:value":c[0]||(c[0]=o=>v.value.qp_postId_eq=o),options:a.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(g,{span:"24 s:12 m:6",label:"评论人：",path:"qp_userId_eq",class:"pr-24px"},{default:n(()=>[e(m,{value:v.value.qp_userId_eq,"onUpdate:value":c[1]||(c[1]=o=>v.value.qp_userId_eq=o),options:N.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(g,{span:"24 m:6",class:"pr-24px"},{default:n(()=>[e(p,{class:"w-full",justify:"start"},{default:n(()=>[e(P,{onClick:C},{icon:n(()=>[e(z,{class:"text-icon"})]),default:n(()=>[V(" "+A(i(w)("common.reset")),1)]),_:1}),e(P,{type:"primary",ghost:"",onClick:U},{icon:n(()=>[e($,{class:"text-icon"})]),default:n(()=>[V(" "+A(i(w)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1})}}}),Ue={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Z(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!ye(u)}const He=K({name:"forum_postcomment",__name:"index",setup(u){const I=he(),{bool:_,setTrue:R}=ge();J(),d(null);const{columns:b,columnChecks:k,data:v,loading:T,pagination:C,getData:U,getDataByPage:a,searchParams:x,resetSearchParams:N}=we({apiFn:Pe,apiParams:{currentPage:1,pageSize:10,qp_postId_eq:null,qp_commentContent_like:null,qp_userId_eq:null,qp_commentId_eq:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:"序号",align:"center"},{key:"postId",title:"帖子",align:"center",render:o=>{if(o.postId){let t=[];for(const l of p.value)l.value===o.postId&&t.push(l.label);return t.join("、")}return""}},{key:"commentContent",title:"评论内容",align:"center",render:o=>e("span",{innerHTML:o.commentContent},null)},{key:"userId",title:"评论人",align:"center",render:o=>{if(o.userId){let t=[];for(const l of r.value)l.value===o.userId&&t.push(l.label);return t.join("、")}return""}},{key:"modifyTime",title:"评论时间",width:154,align:"center",render:o=>o.modifyTime?o.modifyTime.replace("T"," "):""},{key:"operate",title:w("common.operate"),align:"center",width:230,render:o=>{let t;return e("div",{class:"flex-center justify-center gap-8px"},[e(L,{type:"primary",ghost:!0,size:"small",onClick:()=>z(o)},Z(t=w("common.edit"))?t:{default:()=>[t]}),e(pe,{onPositiveClick:()=>m(o.id)},{default:()=>w("common.confirmDelete"),trigger:()=>{let l;return e(L,{type:"error",ghost:!0,size:"small"},Z(l=w("common.delete"))?l:{default:()=>[l]})}})])}}]}),{checkedRowKeys:h,onBatchDeleted:O,onDeleted:j}=Ce(v,U),q=d("add");function f(){q.value="add",R()}async function c(){const{error:o,data:t}=await Y(h.value);console.log(h.value),O()}async function m(o){const{error:t,data:l}=await Y(o);console.log(o),j()}const g=d(null);function z(o){q.value="edit",g.value={...o},R()}const P=d([]);function $(){s(),F(),S()}const p=d([]);async function s(){const{error:o,data:t}=await X();if(t){p.value=[];for(const l of t)p.value.push({label:l.title,value:l.id})}}const r=d([]);async function S(){const{error:o,data:t}=await M();if(t){r.value=[];for(const l of t)r.value.push({label:l.name,value:l.id})}}const B=d([]);async function F(){const{error:o,data:t}=await M();if(t){B.value=[];for(const l of t)B.value.push({label:l.name,value:l.id})}}return $(),(o,t)=>{const l=me,H=qe,D=ce;return Q(),be("div",Ue,[e(Te,{model:i(x),"onUpdate:model":t[0]||(t[0]=y=>E(x)?x.value=y:null),onReset:i(N),onSearch:i(a)},null,8,["model","onReset","onSearch"]),e(D,{title:"数据列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[e(l,{columns:i(k),"onUpdate:columns":t[1]||(t[1]=y=>E(k)?k.value=y:null),"disabled-delete":i(h).length===0,loading:i(T),onAdd:f,onDelete:c,onRefresh:i(U)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:n(()=>[e(H,{"checked-row-keys":i(h),"onUpdate:checkedRowKeys":t[2]||(t[2]=y=>E(h)?h.value=y:null),columns:i(b),data:i(v),size:"small","flex-height":!i(I).isMobile,"scroll-x":1088,loading:i(T),"row-key":y=>y.id,remote:"",pagination:i(C),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Re,{visible:i(_),"onUpdate:visible":t[3]||(t[3]=y=>E(_)?_.value=y:null),"operate-type":q.value,"row-data":g.value,"all-pages":P.value,onSubmitted:i(a)},null,8,["visible","operate-type","row-data","all-pages","onSubmitted"])]),_:1})])}}});export{He as default};
