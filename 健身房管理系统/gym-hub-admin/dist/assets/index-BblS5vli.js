import{_ as Re,N as Te}from"./table-header-operation.vue_vue_type_script_setup_true_lang-BvwCvuJW.js";import{aI as Q,aJ as Ue,d as ae,at as te,m as se,au as pe,n as de,q as me,a as fe,r as p,av as ne,c as oe,o as V,w as o,f as e,aK as _e,z as ve,az as he,aA as ye,ax as ge,x as le,B,g as L,t as E,h as r,$ as y,aL as be,aq as Me,L as we,E as Pe,ar as Be,p as Le,b as ee,aC as J,e as K,aD as $e}from"./index-BAq2SbaD.js";import{f as re}from"./user-CToCrV-S.js";import{d as ue,c as je}from"./course-Fx5oIOxk.js";import{u as ze,a as Ve}from"./table-DmjEK7tG.js";import{W as Ie}from"./WangEditor-BCwDbreK.js";import{_ as Ce}from"./Rate-pIVGMApm.js";import{_ as Ee,a as Fe,b as He,c as Ge}from"./round-refresh-DNCv4Ss6.js";import{f as We}from"./courseReserve-DbkDLQYx.js";import{_ as Ke}from"./DataTable-D6rjIJFQ.js";import"./wangEditor-CAqzKAJM.js";import"./RadioGroup-BGb2VClf.js";import"./Pagination-PYMt0YJG.js";function Je(i){return Q({url:Ue("/courseAppraise",i),method:"get"})}function Qe(i){return Q({url:"/courseAppraise",method:"post",data:i})}function xe(i,R){return Q({url:"/courseAppraise/"+i,method:"patch",data:R})}function ie(i){return Q({url:"/courseAppraise/"+i,method:"delete"})}const Xe=ae({name:"CourseAppraiseOperateModal",__name:"courseAppraise-operate-modal",props:te({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:te(["submitted"],["update:visible"]),setup(i,{emit:R}){se();const w=i,T=R,m=pe(i,"visible"),{formRef:I,validate:S,restoreValidation:g}=de(),{defaultRequiredRule:x}=me(),U=fe(()=>({add:"新增",edit:"编辑"})[w.operateType]),a=p(k());function k(){return{id:null,courseId:null,userId:null,content:null,courseAppraise:null}}const F={id:x,courseId:x,userId:x,content:x,courseAppraise:x};function q(){a.value=k(),w.operateType==="edit"&&w.rowData&&Object.assign(a.value,w.rowData),a.value.url&&($.value=[{id:"1",name:"我是react.png",status:"finished",url:a.value.url}],a.value.url)}function D(){m.value=!1}async function b(){var v;if(await S(),a.value.id){const{error:s,data:d}=await xe(a.value.id,a.value);if(s)return}else{const{error:s,data:d}=await Qe(a.value);if(s)return}(v=window.$message)==null||v.success(y("common.updateSuccess")),D(),T("submitted")}ne(m,()=>{m.value?(q(),g(),C(),c()):$.value=[]});const $=p([]),_=p([]);async function C(){const{error:v,data:s}=await ue();if(s){_.value=[];for(const d of s)_.value.push({label:d.name,value:d.id})}}const u=p([]);async function c(){const{error:v,data:s}=await re();if(s){u.value=[];for(const d of s)u.value.push({label:d.name,value:d.id})}}const M=v=>{a.value.content=v};return(v,s)=>{const d=ge,O=ye,A=Ce,h=he,H=ve,G=_e,j=B,P=le,X=be;return V(),oe(X,{show:m.value,"onUpdate:show":s[3]||(s[3]=N=>m.value=N),title:U.value,preset:"card",class:"w-800px"},{footer:o(()=>[e(P,{justify:"end",size:16},{default:o(()=>[e(j,{onClick:D},{default:o(()=>[L(E(r(y)("common.cancel")),1)]),_:1}),e(j,{type:"primary",onClick:b},{default:o(()=>[L(E(r(y)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[e(G,{class:"h-480px pr-20px"},{default:o(()=>[e(H,{ref_key:"formRef",ref:I,model:a.value,rules:F,"label-placement":"left","label-width":100},{default:o(()=>[e(h,{responsive:"screen","item-responsive":""},{default:o(()=>[e(O,{span:"24 m:24",label:"课程：",path:"courseId",class:"pr-24px"},{default:o(()=>[e(d,{value:a.value.courseId,"onUpdate:value":s[0]||(s[0]=N=>a.value.courseId=N),options:_.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(O,{span:"24 m:24",label:"用户：",path:"userId",class:"pr-24px"},{default:o(()=>[e(d,{value:a.value.userId,"onUpdate:value":s[1]||(s[1]=N=>a.value.userId=N),options:u.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(O,{span:"24 m:24",label:"评分：",path:"courseAppraise"},{default:o(()=>[e(A,{value:a.value.courseAppraise,"onUpdate:value":s[2]||(s[2]=N=>a.value.courseAppraise=N)},null,8,["value"])]),_:1}),e(O,{span:"24 m:24",label:"评价：",path:"content"},{default:o(()=>[e(Ie,{contentHtml:a.value.content,onGetWangEditorValue:M},null,8,["contentHtml"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ye=ae({name:"CourseAppraiseSearch",__name:"courseAppraise-search",props:{model:{required:!0},modelModifiers:{}},emits:te(["reset","search"],["update:model"]),setup(i,{emit:R}){const w=se(),T=R,{formRef:m,validate:I,restoreValidation:S}=de(),g=pe(i,"model"),x=fe(()=>{const{patternRules:C}=me();return{userEmail:C.email,userPhone:C.phone}});async function U(){await S(),T("reset")}async function a(){await I(),T("search")}const k=p([]);async function F(){const{error:C,data:u}=await ue();if(u){k.value=[];for(const c of u)k.value.push({label:c.name,value:c.id})}}const q=p([]);async function D(){const{error:C,data:u}=await re();if(u){q.value=[];for(const c of u)q.value.push({label:c.name,value:c.id})}}const b=p([]);async function $(){const{error:C,data:u}=await We();if(u){b.value=[];for(const c of u)b.value.push({label:c.name,value:c.id})}}function _(){F(),D(),$()}return _(),(C,u)=>{const c=ge,M=ye,v=He,s=B,d=Ge,O=le,A=he,h=ve,H=Fe,G=Ee,j=we;return V(),oe(j,{bordered:!1,size:"small",class:"card-wrapper"},{default:o(()=>[e(G,{"default-expanded-names":["courseAppraise-search"]},{default:o(()=>[e(H,{title:"搜索",name:"courseAppraise-search"},{default:o(()=>[e(h,{ref_key:"formRef",ref:m,model:g.value,rules:x.value,"label-placement":"left","label-width":80},{default:o(()=>[e(A,{responsive:"screen","item-responsive":""},{default:o(()=>[r(w).userInfo.role!=="other"?(V(),oe(M,{key:0,span:"24 s:12 m:6",label:"课程：",path:"qp_courseId_eq",class:"pr-24px","label-width":100},{default:o(()=>[e(c,{value:g.value.qp_courseId_eq,"onUpdate:value":u[0]||(u[0]=P=>g.value.qp_courseId_eq=P),options:k.value,placeholder:"请选择"},null,8,["value","options"])]),_:1})):Me("",!0),e(M,{span:"24 s:12 m:6",label:"用户：",path:"qp_userId_eq",class:"pr-24px","label-width":100},{default:o(()=>[e(c,{value:g.value.qp_userId_eq,"onUpdate:value":u[1]||(u[1]=P=>g.value.qp_userId_eq=P),options:q.value,placeholder:"请选择"},null,8,["value","options"])]),_:1}),e(M,{span:"24 m:6",class:"pr-24px","label-width":100},{default:o(()=>[e(O,{class:"w-full",justify:"start"},{default:o(()=>[e(s,{onClick:U},{icon:o(()=>[e(v,{class:"text-icon"})]),default:o(()=>[L(" "+E(r(y)("common.reset")),1)]),_:1}),e(s,{type:"primary",ghost:"",onClick:a},{icon:o(()=>[e(d,{class:"text-icon"})]),default:o(()=>[L(" "+E(r(y)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1})}}}),Ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"},et={class:"p-12px bg-gray-50 rounded border border-gray-200"},tt=["innerHTML"],nt={key:1,class:"text-gray-400"};function ce(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!$e(i)}const vt=ae({name:"courseappraise",__name:"index",setup(i){const R=Pe(),{bool:w,setTrue:T}=Be(),m=se();p(null);const I=p(""),S=p(!1),g=Le({currentPage:1,pageSize:10,qp_courseId_eq:null,qp_userId_eq:null,qp_content_like:null,qp_courseAppraise_like:null,qp_courseId_in:null}),{columns:x,columnChecks:U,data:a,loading:k,pagination:F,getData:q,getDataByPage:D,searchParams:b,resetSearchParams:$}=ze({apiFn:Je,apiParams:g,immediate:!1,columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:"序号",align:"center"},{key:"courseId",title:"课程",align:"center",render:t=>{if(t.courseId){let n=[];for(const l of Y.value)l.value===t.courseId&&n.push(l.label);return n.join("、")}return""}},{key:"userId",title:"用户",align:"center",render:t=>{if(t.userId){let n=[];for(const l of Z.value)l.value===t.userId&&n.push(l.label);return n.join("、")}return""}},{key:"content",title:"评价",align:"center",render:t=>e("span",{innerHTML:t.content},null)},{key:"courseAppraise",title:"评分",align:"center",render:t=>t.courseAppraise===null||t.courseAppraise===void 0?null:e(Ce,{value:t.courseAppraise,readonly:!0},null)},{key:"replyContent",title:"回复",align:"center",render:t=>e("span",{innerHTML:t.replyContent},null)},{key:"modifyUser",title:"修改人",align:"center"},{key:"modifyTime",title:"修改时间",width:154,align:"center",render:t=>t.modifyTime?t.modifyTime.replace("T"," "):""},{key:"operate",title:y("common.operate"),align:"center",width:300,render:t=>{let n;return e("div",{class:"flex-center justify-center gap-8px"},[e(B,{type:"primary",ghost:!0,size:"small",onClick:()=>O(t)},ce(n=y("common.edit"))?n:{default:()=>[n]}),e(B,{type:"info",ghost:!0,size:"small",onClick:()=>H(t)},{default:()=>[L("回复")]}),e(Te,{onPositiveClick:()=>s(t.id)},{default:()=>y("common.confirmDelete"),trigger:()=>{let l;return e(B,{type:"error",ghost:!0,size:"small"},ce(l=y("common.delete"))?l:{default:()=>[l]})}})])}}]}),{checkedRowKeys:_,onBatchDeleted:C,onDeleted:u}=Ve(a,q),c=p("add");function M(){c.value="add",T()}async function v(){const{error:t,data:n}=await ie(_.value);console.log(_.value),C()}async function s(t){const{error:n,data:l}=await ie(t);console.log(t),u()}const d=p(null);function O(t){c.value="edit",d.value={...t},T()}const A=p(!1),h=p({id:null,content:null,replyContent:null});function H(t){h.value={id:t.id,content:t.content||null,replyContent:t.replyContent||null},A.value=!0}async function G(){var z,W;if(!h.value.replyContent){(z=window.$message)==null||z.error("回复内容不能为空");return}const t={replyContent:h.value.replyContent},{error:n,data:l}=await xe(h.value.id,t);n||((W=window.$message)==null||W.success(y("common.updateSuccess")),A.value=!1,D())}const j=p([]);async function P(){Ae(),Ne()}function X(){m.userInfo.role==="other"&&I.value&&(b.qp_courseId_in=I.value),D()}async function N(){try{const{error:t,data:n}=await je({qp_coachId_eq:m.userInfo.userId});if(!t&&n&&n.list&&n.list.length>0){const l=n.list.map(z=>z.id).join(",");return I.value=l,g.qp_courseId_in=l,b.qp_courseId_in=l,!0}return!1}catch(t){return console.error("Failed to fetch coach courses:",t),!1}}ne(()=>m.userInfo.role,async t=>{if(t)if(t==="other"&&m.userInfo.userId){const n=await N();S.value=!0}else t==="admin"&&(g.qp_courseId_in=null,S.value=!0)},{immediate:!0}),ne(S,t=>{if(t){if(m.userInfo.role==="other"&&!I.value)return;q()}});const ke=$,qe=()=>{ke(),m.userInfo.role==="other"&&I.value&&(b.qp_courseId_in=I.value)},Y=p([]);async function Ae(){const{error:t,data:n}=await ue();if(n){Y.value=[];for(const l of n)Y.value.push({label:l.name,value:l.id})}}const Z=p([]);async function Ne(){const{error:t,data:n}=await re();if(n){Z.value=[];for(const l of n)Z.value.push({label:l.name,value:l.id})}}return P(),(t,n)=>{const l=Re,z=Ke,W=le,Se=_e,De=be,Oe=we;return V(),ee("div",Ze,[e(Ye,{model:r(b),"onUpdate:model":n[0]||(n[0]=f=>J(b)?b.value=f:null),onReset:qe,onSearch:X},null,8,["model"]),e(Oe,{title:"数据列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":o(()=>[e(l,{columns:r(U),"onUpdate:columns":n[1]||(n[1]=f=>J(U)?U.value=f:null),"disabled-delete":r(_).length===0,loading:r(k),onAdd:M,onDelete:v,onRefresh:r(q)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:o(()=>[e(z,{"checked-row-keys":r(_),"onUpdate:checkedRowKeys":n[2]||(n[2]=f=>J(_)?_.value=f:null),columns:r(x),data:r(a),size:"small","flex-height":!r(R).isMobile,"scroll-x":1088,loading:r(k),"row-key":f=>f.id,remote:"",pagination:r(F),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Xe,{visible:r(w),"onUpdate:visible":n[3]||(n[3]=f=>J(w)?w.value=f:null),"operate-type":c.value,"row-data":d.value,"all-pages":j.value,onSubmitted:r(D)},null,8,["visible","operate-type","row-data","all-pages","onSubmitted"]),e(De,{show:A.value,"onUpdate:show":n[6]||(n[6]=f=>A.value=f),title:"回复评价",preset:"card",class:"w-800px"},{footer:o(()=>[e(W,{justify:"end",size:16},{default:o(()=>[e(r(B),{onClick:n[5]||(n[5]=f=>A.value=!1)},{default:o(()=>[L(E(r(y)("common.cancel")),1)]),_:1}),e(r(B),{type:"primary",onClick:G},{default:o(()=>[L(E(r(y)("common.confirm")),1)]),_:1})]),_:1})]),default:o(()=>[e(Se,{class:"h-480px pr-20px"},{default:o(()=>[e(W,{vertical:""},{default:o(()=>[K("div",null,[n[7]||(n[7]=K("div",{class:"font-semibold mb-8px"},"原评价内容：",-1)),K("div",et,[h.value.content?(V(),ee("div",{key:0,innerHTML:h.value.content,class:"prose prose-sm max-w-none"},null,8,tt)):(V(),ee("div",nt,"暂无评价内容"))])]),K("div",null,[n[8]||(n[8]=K("div",{class:"font-semibold mb-8px"},"回复内容：",-1)),e(Ie,{contentHtml:h.value.replyContent,onGetWangEditorValue:n[4]||(n[4]=f=>h.value.replyContent=f)},null,8,["contentHtml"])])]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})])}}});export{vt as default};
